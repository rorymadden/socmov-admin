<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-fab/paper-fab.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html"><link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html"><link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/social-media-icons/social-media-icons.html"><link rel="import" href="../bower_components/file-fire/file-fire.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="socmov-admin-attendees"><template><style include="shared-styles iron-flex iron-flex-alignment">:host{display:block;padding:10px;}h1{margin:16px 50px 16px 0px;}paper-button{margin-top:10px;}.primaryButton{background-color:var(--paper-blue-500);color:white;}.form{padding:20px;}social-media-icons{padding:5px;}social-media-icons.inactive{color:grey;}paper-toggle-button{display:inline-block;}paper-icon-button[hidden], social-media-icons[hidden]{display:none;}.page-header{@apply --layout-horizontal;}.page-filter{padding:20px 20px 0px 0px;}.companyImage{max-height:30px;width:auto;height:auto;}#attendeeDialog{width:calc(100vw - 100px);height:calc(100vh - 150px);margin:0;padding:0;top:100px;}paper-icon-button.green{color:var(--paper-green-500);}paper-icon-button.red{color:var(--paper-red-500);}</style><firebase-query id="attendeesQuery" app-name="socmov" path="{{conf}}/attendees/active" data="{{attendeesList}}"></firebase-query><firebase-document id="attendeeDoc" app-name="socmov" data="{{attendeeData}}"></firebase-document><paper-dialog id="attendeeDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Attendee</h2><div class="layout vertical form"><div class="horizontal layout"><paper-input id="first" type="text" label="First Name" required="" autofocus="" error-message="Please enter a first name" value="{{attendeeData.first}}"></paper-input><div class="flex"></div><paper-input id="last" type="text" label="Last Name" required="" error-message="Please enter a last name" value="{{attendeeData.last}}"></paper-input><div class="flex"></div><paper-input id="jobTitle" type="text" label="Job Title" required="" error-message="Please enter a job title" value="{{attendeeData.jobTitle}}"></paper-input><div class="flex"></div><paper-dropdown-menu id="role" label="Role" value="{{attendeeData.role}}"><paper-listbox slot="dropdown-content" selected="{{_setSelectedIndex(attendeeData.role, roles)}}"><template is="dom-repeat" items="[[roles]]"><paper-item>[[item]]</paper-item></template></paper-listbox></paper-dropdown-menu><div class="flex"></div><paper-input id="company" type="text" label="Company" required="" error-message="Please enter a company name" value="{{attendeeData.company}}"></paper-input></div><div class="horizontal layout"><paper-input id="country" type="text" label="Country" error-message="Please enter a country" value="{{attendeeData.country}}"></paper-input><div class="flex"></div><paper-input id="linkedin" type="text" label="LinkedIn" value="{{attendeeData.linkedin}}"></paper-input><div class="flex"></div><paper-input id="profileImage" type="text" label="Profile Image" value="{{attendeeData.profileImage}}"></paper-input><div class="flex"></div><paper-input id="companyImage" type="text" label="Company Image" value="{{attendeeData.companyImage}}"></paper-input></div></div><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button class="primaryButton" on-tap="_create">Save</paper-button></div></paper-dialog><div class="card"><div class="page-header"><div><h1>Attendees {{activeString}}</h1></div><div><paper-button on-tap="_showCreateDialog" disabled="[[!online]]" aria-label="Add attendee" class="primaryButton">Create New</paper-button></div><div class="flex"></div><div class="page-filter"><paper-toggle-button checked="{{_filterActive}}" slot="filter"></paper-toggle-button></div></div><vaadin-grid aria-label="attendees" items="[[filteredAttendeeList]]" id="grid"><vaadin-grid-column><template class="header">First Name</template><template>[[item.first]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Last Name</template><template>[[item.last]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Role</template><template>[[item.last]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Job Title</template><template>[[item.jobTitle]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Company</template><template>[[item.company]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Country</template><template>[[item.country]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Profile Image</template><template><paper-icon-button icon="icons:check" class="green" hidden$="[[!item.profileImage]]"><paper-icon-button icon="icons:close" class="red" hidden$="[[item.profileImage]]"></paper-icon-button></paper-icon-button></template></vaadin-grid-column><vaadin-grid-column><template class="header">Company Image</template><template><paper-icon-button icon="icons:check" class="green" hidden$="[[!item.companyImage]]"><paper-icon-button icon="icons:close" class="red" hidden$="[[item.companyImage]]"></paper-icon-button></paper-icon-button></template></vaadin-grid-column><vaadin-grid-column><template class="header">Social</template><template><div class="layout horizontal"><social-media-icons icon="twitter" hidden$="{{activeSocial(item.twitter)}}" size="15"></social-media-icons><social-media-icons icon="linkedin" hidden$="{{activeSocial(item.linkedin)}}" size="15"></social-media-icons><social-media-icons icon="instagram" hidden$="{{activeSocial(item.instagram)}}" size="15"></social-media-icons><social-media-icons icon="github" hidden$="{{activeSocial(item.github)}}" size="15"></social-media-icons></div></template></vaadin-grid-column><vaadin-grid-column><template><div style="display: flex"><paper-icon-button icon="icons:create" on-tap="_showEditDialog" focus-target$="[[!editing]]"></paper-icon-button><paper-icon-button icon="icons:remove-circle" hidden$="[[!_filterActive]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:restore" hidden$="[[_filterActive]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:delete-forever" hidden$="[[_filterActive]]" on-tap="_showConfirmDialog"></paper-icon-button></div></template></vaadin-grid-column></vaadin-grid></div><paper-dialog id="confirmDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Are you sure you want to delete the record?</h2><paper-dialog-scrollable>This is final - you can't get it back!</paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button dialog-confirm="" autofocus="" on-tap="_delete">Accept</paper-button></div></paper-dialog></template><script>var roles=['development','design','product','project','marketing','sales','data','operations','recruitment','test','ux','vc','other'];class SocmovAdminattendees extends Polymer.Element{static get is(){return'socmov-admin-attendees'}static get properties(){return{attendeesList:{type:Object},filteredAttendeeList:Object,attendeeData:{type:Object,value:function(){return{}}},_filterActive:{type:Boolean,value:!0,observer:'_filterData'},activeString:String,_selectedItem:Object,roles:{type:Array,value:roles}}}static get observers(){return['_filterData(attendeesList.*)']}_filterData(){this.filteredAttendeeList=[],this.attendeesList&&this.attendeesList.forEach(function(b){'active'===b.$key&&this._filterActive?Object.keys(b).forEach(function(c){'$key'!==c&&b[c]&&(b[c].$key=c,this.push('filteredAttendeeList',b[c]))}.bind(this)):'inactive'===b.$key&&!this._filterActive&&Object.keys(b).forEach(function(c){'$key'!==c&&b[c]&&(b[c].$key=c,this.push('filteredAttendeeList',b[c]))}.bind(this))}.bind(this)),this.activeString=this._filterActive?'(Published)':'(UnPublished)',this.$.grid.clearCache()}_toggleActive(a){this.attendeeData=a.model.item;var b=this._filterActive?'active/':'inactive/',c=this._filterActive?'inactive/':'active/',d=Object.assign({},this.attendeeData);delete d.$key,this.$.attendeesQuery.ref.child(c+this.attendeeData.$key).set(d).then(function(){this.$.attendeesQuery.ref.child(b+this.attendeeData.$key).remove().then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}.bind(this))}_saveAttendeeData(){var a=Object.assign({},this.attendeeData);delete a.$key;var b=this._filterActive?'active/':'inactive/';this.$.attendeesQuery.ref.child(b+this.attendeeData.$key).set(a).then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}_showConfirmDialog(a){this.$.confirmDialog.open(),this._selectedItem=a.model.item}_showCreateDialog(){this.attendeeData={},this.$.attendeeDoc.reset(),this.$.attendeeDialog.open()}_showEditDialog(a){this.$.attendeeDoc.data=Object.assign({},a.model.item),this.$.attendeeDialog.open()}_create(){if(this.$.first.validate(),this.$.last.validate(),this.$.jobTitle.validate(),this.$.company.validate(),!this.$.first.invalid&&!this.$.last.invalid&&!this.$.jobTitle.invalid&&!this.$.company.invalid){if(!this.attendeeData.$key)return this.attendeeData.active=!0,this.$.attendeeDialog.close(),console.log('called',Date.now()),this.$.attendeeDoc.saveValue(this.conf+'/attendees/active').then(function(){console.log('called second',Date.now()),this.$.attendeeDoc.reset(),this.$.grid.clearCache()}.bind(this));var a=Object.assign({},this.attendeeData);delete a.$key;var b=this._filterActive?'active/':'inactive/';this.$.attendeeDialog.close(),this.$.attendeesQuery.ref.child(b+this.attendeeData.$key).set(a),this.$.attendeeDoc.reset(),this.$.grid.clearCache()}else return}_delete(){return this.$.attendeesQuery.ref.child('inactive/'+this._selectedItem.$key).set(null).then(function(){this.$.attendeeDoc.reset(),this._selectedItem=null,this.$.grid.clearCache()}.bind(this))}activeSocial(a){return!a}_removeCompanyImage(a){this._removeImage('companyImage',a)}_removeattendeeImage(a){this._removeImage('attendeeImage',a)}_removeImage(a,b){this.attendeeData=b.model.item,delete this.attendeeData[a],this.attendeeData=JSON.parse(JSON.stringify(this.attendeeData)),this._saveAttendeeData()}_trimText(a){var b=10;return a?a.length>b?a.substring(0,b-3)+'...':a:null}_setSelectedIndex(a,b){var c;return b?(b.forEach(function(d,f){d===a&&(c=f)}),c):null}}window.customElements.define(SocmovAdminattendees.is,SocmovAdminattendees);</script></dom-module></body></html>