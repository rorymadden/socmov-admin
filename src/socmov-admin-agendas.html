<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-chip/paper-chip-input.html"><link rel="import" href="../bower_components/paper-chip/paper-chip.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html"><link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html"><link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/vaadin-date-picker/vaadin-date-picker.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="socmov-admin-agendas"><template><style include="shared-styles iron-flex iron-flex-alignment">:host{display:block;padding:10px;}h1{margin:16px 50px 16px 0px;}paper-button{margin-top:10px;}.primaryButton{background-color:var(--paper-blue-500);color:white;}.form{padding:20px;}paper-toggle-button{display:inline-block;}paper-icon-button[hidden], social-media-icons[hidden]{display:none;}paper-input{padding-right:20px;}input[readonly]{border:2px solid transparent;}.page-header{@apply --layout-horizontal;}.page-filter{padding:20px 20px 0px 0px;}.newConference{padding-bottom:30px;}</style><firebase-query id="agendaQuery" app-name="socmov" path="{{conf}}/agendas" data="{{agendasList}}"></firebase-query><firebase-document id="agendaDoc" app-name="socmov" data="{{agendaData}}"></firebase-document><div class="card"><div class="page-header"><div><h1>Agendas</h1></div><div class="flex"></div><div class="page-filter"><paper-toggle-button checked="{{_filterActive}}" slot="filter"></paper-toggle-button></div></div><vaadin-grid aria-label="agendas" items="[[filteredAgendasList]]" id="grid"><vaadin-grid-column><template class="header">Name</template><template><a name="agendas" href="/agenda-sessions/[[item.$key]]" hidden$="[[_isEditingOrInactive(editing, item)]]">[[item.name]]</a> <span hidden="[[_filterActive]]">[[item.name]]</span> <input id="name-[[index]]" value="[[item.name]]" on-input="_storeName" hidden$="[[!_isEditing(editing, item)]]"></template></vaadin-grid-column><vaadin-grid-column><template class="header">Streams</template><template><paper-chip-input id="streams-[[index]]" label="Streams" closable="[[_isEditing(editing, item)]]" items="{{item.streams}}" readonly="[[!_isEditing(editing, item)]]" on-input="_storeStreams"></paper-chip-input></template></vaadin-grid-column><vaadin-grid-column><template class="header">Sessions</template><template><input id="sessions-[[index]]" value="[[_countSessions(item.sessionKeys)]]" readonly="true"></template></vaadin-grid-column><vaadin-grid-column><template><div style="display: flex"><paper-icon-button icon="icons:create" hidden="[[!_filterActive]]" on-tap="_edit" focus-target$="[[!editing]]"></paper-icon-button><paper-icon-button icon="icons:save" hidden="[[!_isEditing(editing, item)]]" on-tap="_save" focus-target$="[[editing]]"></paper-icon-button><paper-icon-button icon="icons:cancel" hidden="[[!_isEditing(editing, item)]]" on-tap="_cancel"></paper-icon-button><paper-icon-button icon="icons:remove-circle" hidden$="[[!_isActive(editing, item)]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:restore" hidden$="[[_isActive(editing, item)]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:delete-forever" hidden$="[[_isActive(editing, item)]]" on-tap="_showConfirmDialog"></paper-icon-button></div></template></vaadin-grid-column></vaadin-grid></div><paper-dialog id="confirmDialog"><h2>Are you sure you want to delete the record?</h2><paper-dialog-scrollable>This is final - you can't get it back!</paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button dialog-confirm="" autofocus="" on-tap="_delete">Accept</paper-button></div></paper-dialog></template><script>class SocmovAdminAgendas extends Polymer.Element{static get is(){return'socmov-admin-agendas'}static get properties(){return{agendasList:{type:Object},filteredAgendasList:Object,agendaData:{type:Object,value:function(){return{}}},_filterActive:{type:Boolean,value:!0,observer:'_filterData'},editing:Object}}static get observers(){return['_filterData(agendasList.*)']}ready(){super.ready(),this.editing=null}connectedCallback(){super.connectedCallback(),this.addEventListener('items_changed',function(a){this._streams=a.detail.items})}disconnectedCallback(){super.disconnectedCallback()}_filterData(){this.filteredAgendasList=[],this.agendasList&&this.agendasList.forEach(function(b){'active'===b.$key&&this._filterActive?Object.keys(b).forEach(function(c){'$key'!==c&&b[c]&&(b[c].$key=c,this.push('filteredAgendasList',b[c]))}.bind(this)):'inactive'===b.$key&&!this._filterActive&&Object.keys(b).forEach(function(c){'$key'!==c&&b[c]&&(b[c].$key=c,this.push('filteredAgendasList',b[c]))}.bind(this))}.bind(this)),this.activeString=this._filterActive?'(Published)':'(UnPublished)',this.$.grid.clearCache()}_storeName(a){this._name=a.target.value}_storeStreams(a){this._streams=a.target.items}_isEditing(a,b){return b===a}_isEditingOrInactive(a,b){return!this._filterActive||b===a}_isActive(a,b){return b&&(b===a||b.active)}_edit(a){var b=a.model.item;this.editing=b,this._name=b.name,this._streams=b.streams,this.$.grid.querySelector('#name-'+a.model.index).focus()}_save(a){this.agendaData=a.model.item,this.agendaData.name=this._name,this.agendaData.streams=this._streams,this._saveAgendaData(),this.editing=null,this.$.grid.clearCache()}_cancel(){this.editing=null,this.$.grid.clearCache()}_showConfirmDialog(a){this.$.confirmDialog.open(),this._selectedItem=a.model.item}_toggleActive(a){this.agendaData=a.model.item;var b=this._filterActive?'active/':'inactive/',c=this._filterActive?'inactive/':'active/',d=Object.assign({},this.agendaData);delete d.$key,this.$.agendaQuery.ref.child(c+this.agendaData.$key).set(d).then(function(){this.$.agendaQuery.ref.child(b+this.agendaData.$key).remove().then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}.bind(this))}_saveAgendaData(){var a=Object.assign({},this.agendaData);delete a.$key;var b=this._filterActive?'active/':'inactive/';this.$.agendaQuery.ref.child(b+this.agendaData.$key).set(a).then(function(){this._filterData(),this.agendaData=null,this.$.grid.clearCache()}.bind(this))}_create(){if(this.$.name.validate(),!this.$.name.invalid){if(!this.agendaData.$key)return this.agendaData.active=!0,this.$.agendaDoc.saveValue(this.conf+'/agendas/active').then(function(){this.$.agendaDoc.reset(),this.$.grid.clearCache()}.bind(this));var a=Object.assign({},this.agendaData);delete a.$key;var b=this._filterActive?'active/':'inactive/';return this.$.agendaQuery.ref.child(b+this.agendaData.$key).set(a).then(function(){this.$.agendaDoc.reset(),this.$.grid.clearCache()}.bind(this))}}_delete(){return this.$.agendaQuery.ref.child('inactive/'+this._selectedItem.$key).set(null).then(function(){this.$.agendaDoc.reset(),this.$.grid.clearCache()}.bind(this))}_countSessions(a){return a?a.length:0}}window.customElements.define(SocmovAdminAgendas.is,SocmovAdminAgendas);</script></dom-module></body></html>