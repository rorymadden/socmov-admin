<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-fab/paper-fab.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html"><link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html"><link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/social-media-icons/social-media-icons.html"><link rel="import" href="../bower_components/file-fire/file-fire.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="socmov-admin-speakers"><template><style include="shared-styles iron-flex iron-flex-alignment">:host{display:block;padding:10px;}h1{margin:16px 50px 16px 0px;}paper-button{margin-top:10px;}.primaryButton{background-color:var(--paper-blue-500);color:white;}.form{padding:20px;}social-media-icons{padding:5px;}social-media-icons.inactive{color:grey;}paper-toggle-button{display:inline-block;}paper-icon-button[hidden], social-media-icons[hidden]{display:none;}.page-header{@apply --layout-horizontal;}.page-filter{padding:20px 20px 0px 0px;}.companyImage{max-height:30px;width:auto;height:auto;}#speakerDialog{width:calc(100vw - 100px);height:calc(100vh - 150px);margin:0;padding:0;top:100px;}paper-icon-button.green{color:var(--paper-green-500);}paper-icon-button.red{color:var(--paper-red-500);}</style><firebase-query id="speakersQuery" app-name="socmov" path="{{conf}}/speakers" data="{{speakersList}}"></firebase-query><firebase-document id="speakerDoc" app-name="socmov" data="{{speakerData}}"></firebase-document><paper-dialog id="speakerDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Speaker</h2><div class="layout vertical form"><div class="horizontal layout"><paper-input id="first" type="text" label="First Name" required="" autofocus="" error-message="Please enter a first name" value="{{speakerData.first}}"></paper-input><div class="flex"></div><paper-input id="last" type="text" label="Last Name" required="" error-message="Please enter a last name" value="{{speakerData.last}}"></paper-input></div><div class="horizontal layout"><paper-input id="jobTitle" type="text" label="Job Title" required="" error-message="Please enter a job title" value="{{speakerData.jobTitle}}"></paper-input><div class="flex"></div><paper-input id="company" type="text" label="Company" required="" error-message="Please enter a company name" value="{{speakerData.company}}"></paper-input></div><paper-input id="country" type="text" label="Country" required="" error-message="Please enter a country" value="{{speakerData.country}}"></paper-input><paper-textarea id="bio" label="Bio" always-float-label="" rows="3" value="{{speakerData.bio}}"></paper-textarea><div class="horizontal layout"><paper-input id="twitter" type="text" label="Twitter" value="{{speakerData.twitter}}"></paper-input><paper-input id="linkedin" type="text" label="LinkedIn" value="{{speakerData.linkedin}}"></paper-input><paper-input id="instagram" type="text" label="Instagram" value="{{speakerData.instagram}}"></paper-input><paper-input id="github" type="text" label="Github" value="{{speakerData.github}}"></paper-input></div>Published<paper-toggle-button checked="{{speakerData.published}}" slot="filter"></paper-toggle-button></div><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button class="primaryButton" on-tap="_create">Save</paper-button></div></paper-dialog><div class="card"><div class="page-header"><div><h1>Speakers {{activeString}}</h1></div><div><paper-button on-tap="_showCreateDialog" disabled="[[!online]]" aria-label="Add speaker" class="primaryButton">Create New</paper-button></div><div class="flex"></div><div class="page-filter"><paper-toggle-button checked="{{_filterActive}}" slot="filter"></paper-toggle-button></div></div><vaadin-grid aria-label="Speakers" items="[[filteredSpeakerList]]" id="grid"><vaadin-grid-column><template class="header">First Name</template><template>[[item.first]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Last Name</template><template>[[item.last]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Job Title</template><template>[[item.jobTitle]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Bio</template><template>[[_trimText(item.bio)]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Company</template><template>[[item.company]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Country</template><template>[[item.country]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Speaker (250x250)</template><template><template is="dom-if" if="[[item.speakerImage]]"><img src="[[item.speakerImage.placeholder]]" width="30" height="30" on-click="_removeSpeakerImage"></template><template is="dom-if" if="[[!item.speakerImage]]"><file-fire app-name="socmov" path="/speakers/{{item.$key}}" progress="{{remoteProgress}}"></file-fire></template></template></vaadin-grid-column><vaadin-grid-column><template class="header">Company (Max W:200, H:60)</template><template><template is="dom-if" if="[[item.companyImage]]"><img src="[[item.companyImage.placeholder]]" on-click="_removeCompanyImage" class="companyImage"></template><template is="dom-if" if="[[!item.companyImage]]"><file-fire app-name="socmov" path="/companies/{{item.$key}}" progress="{{remoteProgress}}"></file-fire></template></template></vaadin-grid-column><vaadin-grid-column><template class="header">Social</template><template><div class="layout horizontal"><social-media-icons icon="twitter" hidden$="{{activeSocial(item.twitter)}}" size="15"></social-media-icons><social-media-icons icon="linkedin" hidden$="{{activeSocial(item.linkedin)}}" size="15"></social-media-icons><social-media-icons icon="instagram" hidden$="{{activeSocial(item.instagram)}}" size="15"></social-media-icons><social-media-icons icon="github" hidden$="{{activeSocial(item.github)}}" size="15"></social-media-icons></div></template></vaadin-grid-column><vaadin-grid-column><template class="header">Published</template><template><paper-icon-button icon="icons:check" class="green" hidden$="[[!item.published]]"><paper-icon-button icon="icons:close" class="red" hidden$="[[item.published]]"></paper-icon-button></paper-icon-button></template></vaadin-grid-column><vaadin-grid-column><template><div style="display: flex"><paper-icon-button icon="icons:create" on-tap="_showEditDialog" focus-target$="[[!editing]]"></paper-icon-button><paper-icon-button icon="icons:remove-circle" hidden$="[[!_filterActive]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:restore" hidden$="[[_filterActive]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:delete-forever" hidden$="[[_filterActive]]" on-tap="_showConfirmDialog"></paper-icon-button></div></template></vaadin-grid-column></vaadin-grid></div><paper-dialog id="confirmDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Are you sure you want to delete the record?</h2><paper-dialog-scrollable>This is final - you can't get it back!</paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button dialog-confirm="" autofocus="" on-tap="_delete">Accept</paper-button></div></paper-dialog></template><script>class SocmovAdminSpeakers extends Polymer.Element{static get is(){return'socmov-admin-speakers'}static get properties(){return{speakersList:{type:Object},filteredSpeakerList:Object,speakerData:{type:Object,value:function(){return{}}},_filterActive:{type:Boolean,value:!0,observer:'_filterData'},activeString:String,_selectedItem:Object}}static get observers(){return['_filterData(speakersList.*)']}ready(){super.ready()}connectedCallback(){super.connectedCallback(),this.addEventListener('upload',this._handleUpload)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener('upload',this._handleUpload)}_filterData(){this.filteredSpeakerList=[],this.speakersList&&this.speakersList.forEach(function(b){'active'===b.$key&&this._filterActive?Object.keys(b).forEach(function(c){'$key'!==c&&b[c]&&(b[c].$key=c,this.push('filteredSpeakerList',b[c]))}.bind(this)):'inactive'===b.$key&&!this._filterActive&&Object.keys(b).forEach(function(c){'$key'!==c&&b[c]&&(b[c].$key=c,this.push('filteredSpeakerList',b[c]))}.bind(this))}.bind(this)),this.activeString=this._filterActive?'(Published)':'(UnPublished)',this.$.grid.clearCache()}_handleUpload(a){console.log('test'),this.speakerData=this.filteredSpeakerList.filter(function(c){return c.$key===a.detail.urls[0].name}.bind(this))[0];var b;-1!==a.detail.urls[0].url.indexOf('/speakers')&&(b='speakerImage'),-1!==a.detail.urls[0].url.indexOf('/companies')&&(b='companyImage'),console.log('field',b,a.detail.urls[0].url),b?(this.speakerData[b]={placeholder:a.detail.placeholder,url:a.detail.urls[0].url},this._saveSpeakerData()):console.log('Upload error',a.detail.urls[0].url)}_toggleActive(a){this.speakerData=a.model.item;var b=this._filterActive?'active/':'inactive/',c=this._filterActive?'inactive/':'active/',d=Object.assign({},this.speakerData);delete d.$key,this.$.speakersQuery.ref.child(c+this.speakerData.$key).set(d).then(function(){this.$.speakersQuery.ref.child(b+this.speakerData.$key).remove().then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}.bind(this))}_saveSpeakerData(){var a=Object.assign({},this.speakerData);delete a.$key;var b=this._filterActive?'active/':'inactive/';this.$.speakersQuery.ref.child(b+this.speakerData.$key).set(a).then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}_showConfirmDialog(a){this.$.confirmDialog.open(),this._selectedItem=a.model.item}_showCreateDialog(){this.speakerData={},this.$.speakerDoc.reset(),this.$.speakerDialog.open()}_showEditDialog(a){this.$.speakerDoc.data=Object.assign({},a.model.item),this.$.speakerDialog.open()}_create(){if(this.$.first.validate(),this.$.last.validate(),this.$.jobTitle.validate(),this.$.company.validate(),this.$.country.validate(),!this.$.first.invalid&&!this.$.last.invalid&&!this.$.jobTitle.invalid&&!this.$.company.invalid&&!this.$.country.invalid){if(!this.speakerData.$key)return this.speakerData.active=!0,this.$.speakerDialog.close(),console.log('called',Date.now()),this.$.speakerDoc.saveValue(this.conf+'/speakers/active').then(function(){console.log('called second',Date.now()),this.$.speakerDoc.reset(),this.$.grid.clearCache()}.bind(this));var a=Object.assign({},this.speakerData);delete a.$key;var b=this._filterActive?'active/':'inactive/';this.$.speakerDialog.close(),this.$.speakersQuery.ref.child(b+this.speakerData.$key).set(a),this.$.speakerDoc.reset(),this.$.grid.clearCache()}else return}_delete(){return this.$.speakersQuery.ref.child('inactive/'+this._selectedItem.$key).set(null).then(function(){this.$.speakerDoc.reset(),this._selectedItem=null,this.$.grid.clearCache()}.bind(this))}activeSocial(a){return!a}_removeCompanyImage(a){this._removeImage('companyImage',a)}_removeSpeakerImage(a){this._removeImage('speakerImage',a)}_removeImage(a,b){this.speakerData=b.model.item,delete this.speakerData[a],this.speakerData=JSON.parse(JSON.stringify(this.speakerData)),this._saveSpeakerData()}_trimText(a){var b=10;return a?a.length>b?a.substring(0,b-3)+'...':a:null}}window.customElements.define(SocmovAdminSpeakers.is,SocmovAdminSpeakers);</script></dom-module></body></html>