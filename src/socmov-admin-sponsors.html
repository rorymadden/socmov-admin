<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-fab/paper-fab.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-item/paper-item.html"><link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html"><link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html"><link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/social-media-icons/social-media-icons.html"><link rel="import" href="../bower_components/file-fire/file-fire.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="socmov-admin-sponsors"><template><style include="shared-styles iron-flex iron-flex-alignment">:host{display:block;padding:10px;}h1{margin:16px 50px 16px 0px;}paper-button{margin-top:10px;}.primaryButton{background-color:var(--paper-blue-500);color:white;}.form{padding:20px;}social-media-icons{padding:5px;}social-media-icons.inactive{color:grey;}paper-toggle-button{display:inline-block;}paper-icon-button[hidden], social-media-icons[hidden]{display:none;}.page-header{@apply --layout-horizontal;}.page-filter{padding:20px 20px 0px 0px;}.companyImage{max-height:30px;width:auto;height:auto;}#sponsorDialog{width:calc(100vw - 100px);height:calc(100vh - 150px);margin:0;padding:0;top:100px;}</style><firebase-query id="sponsorsQuery" app-name="socmov" path="{{conf}}/sponsors" data="{{sponsorsList}}"></firebase-query><firebase-document id="sponsorDoc" app-name="socmov" data="{{sponsorData}}"></firebase-document><paper-dialog id="sponsorDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Sponsor</h2><div class="layout vertical form"><div class="horizontal layout"><paper-input id="name" type="text" label="Name" required="" autofocus="" error-message="Please enter a company name" value="{{sponsorData.name}}"></paper-input><div class="flex"></div><paper-dropdown-menu id="level" label="Levels" required="" error-message="Please enter a Level" value="{{sponsorData.level}}"><paper-listbox slot="dropdown-content" selected="{{_setSelectedLevel(sponsorData.level)}}"><template is="dom-repeat" items="[[levelOptions]]"><paper-item>[[item.name]]</paper-item></template></paper-listbox></paper-dropdown-menu></div><paper-input id="url" type="url" label="Url" required="" error-message="Please enter a url" value="{{sponsorData.url}}"></paper-input><paper-textarea id="bio" label="Bio" always-float-label="" rows="3" value="{{sponsorData.bio}}"></paper-textarea><div class="horizontal layout"><paper-input id="twitter" type="text" label="Twitter" value="{{sponsorData.twitter}}"></paper-input><paper-input id="linkedin" type="text" label="LinkedIn" value="{{sponsorData.linkedin}}"></paper-input><paper-input id="instagram" type="text" label="Instagram" value="{{sponsorData.instagram}}"></paper-input><paper-input id="github" type="text" label="Github" value="{{sponsorData.github}}"></paper-input></div></div><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button class="primaryButton" on-tap="_create">Save</paper-button></div></paper-dialog><div class="card"><div class="page-header"><div><h1>Sponsors {{activeString}}</h1></div><div><paper-button on-tap="_showCreateDialog" disabled="[[!online]]" aria-label="Add sponsor" class="primaryButton">Create New</paper-button>(Created inactive)</div><div class="flex"></div><div class="page-filter"><paper-toggle-button checked="{{_filterActive}}" slot="filter"></paper-toggle-button></div></div><vaadin-grid aria-label="sponsors" items="[[filteredSponsorsList]]" id="grid"><vaadin-grid-column><template class="header">Name</template><template>[[item.name]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Level</template><template>[[item.level]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Url</template><template>[[item.url]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Bio</template><template>[[_trimText(item.bio)]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">sponsor</template><template><template is="dom-if" if="[[item.sponsorImage]]"><img src="[[item.sponsorImage.placeholder]]" width="30" height="30" on-click="_removeSponsorImage"></template><template is="dom-if" if="[[!item.sponsorImage]]"><file-fire app-name="socmov" path="/sponsors/{{item.$key}}" progress="{{remoteProgress}}"></file-fire></template></template></vaadin-grid-column><vaadin-grid-column><template class="header">Social</template><template><div class="layout horizontal"><social-media-icons icon="twitter" hidden$="{{activeSocial(item.twitter)}}" size="15"></social-media-icons><social-media-icons icon="linkedin" hidden$="{{activeSocial(item.linkedin)}}" size="15"></social-media-icons><social-media-icons icon="instagram" hidden$="{{activeSocial(item.instagram)}}" size="15"></social-media-icons><social-media-icons icon="github" hidden$="{{activeSocial(item.github)}}" size="15"></social-media-icons></div></template></vaadin-grid-column><vaadin-grid-column><template><div style="display: flex"><paper-icon-button icon="icons:create" on-tap="_showEditDialog" focus-target$="[[!editing]]"></paper-icon-button><paper-icon-button icon="icons:remove-circle" hidden$="[[!_filterActive]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:restore" hidden$="[[_filterActive]]" on-tap="_toggleActive"></paper-icon-button><paper-icon-button icon="icons:delete-forever" hidden$="[[_filterActive]]" on-tap="_showConfirmDialog"></paper-icon-button></div></template></vaadin-grid-column></vaadin-grid></div><paper-dialog id="confirmDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Are you sure you want to delete the record?</h2><paper-dialog-scrollable>This is final - you can't get it back!</paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button dialog-confirm="" autofocus="" on-tap="_delete">Accept</paper-button></div></paper-dialog></template><script>var levels=[{value:1,name:'1. Platinum'},{value:2,name:'2. Gold'},{value:3,name:'3. Silver'},{value:4,name:'4. Bronze'},{value:5,name:'5. Supporter'}];class SocmovAdminSponsors extends Polymer.Element{static get is(){return'socmov-admin-sponsors'}static get properties(){return{sponsorsList:{type:Object},filteredSponsorsList:Object,sponsorData:{type:Object,value:function(){return{}}},_filterActive:{type:Boolean,value:!0,observer:'_filterData'},activeString:String,levelOptions:{type:Object,value:levels},_selectedItem:Object}}static get observers(){return['_filterData(sponsorsList.*)']}ready(){super.ready()}connectedCallback(){super.connectedCallback(),this.addEventListener('upload',this._handleUpload)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener('upload',this._handleUpload)}_filterData(){this.filteredSponsorsList=[],this.sponsorsList&&this.sponsorsList.forEach(function(a){'active'===a.$key&&this._filterActive?Object.keys(a).forEach(function(b){'$key'!==b&&a[b]&&(a[b].$key=b,this.push('filteredSponsorsList',a[b]))}.bind(this)):'inactive'===a.$key&&!this._filterActive&&Object.keys(a).forEach(function(b){'$key'!==b&&a[b]&&(a[b].$key=b,this.push('filteredSponsorsList',a[b]))}.bind(this))}.bind(this)),this.activeString=this._filterActive?'(Published)':'(UnPublished)',this.$.grid.clearCache()}_handleUpload(a){this.sponsorData=this.filteredSponsorsList.filter(function(c){return c.$key===a.detail.urls[0].name}.bind(this))[0];var b;-1!==a.detail.urls[0].url.indexOf('/sponsors')&&(b='sponsorImage'),b?(this.sponsorData[b]={placeholder:a.detail.placeholder,url:a.detail.urls[0].url},this._savesponsorData()):console.log('Upload error',a.detail.urls[0].url)}_toggleActive(a){this.sponsorData=a.model.item;var b=this._filterActive?'active/':'inactive/',c=this._filterActive?'inactive/':'active/',d=Object.assign({},this.sponsorData);delete d.$key,this.$.sponsorsQuery.ref.child(c+this.sponsorData.$key).set(d).then(function(){this.$.sponsorsQuery.ref.child(b+this.sponsorData.$key).remove().then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}.bind(this))}_savesponsorData(){var a=Object.assign({},this.sponsorData);delete a.$key;var b=this._filterActive?'active/':'inactive/';this.$.sponsorsQuery.ref.child(b+this.sponsorData.$key).set(a).then(function(){this._filterData(),this.$.grid.clearCache()}.bind(this))}_showConfirmDialog(a){this.$.confirmDialog.open(),this._selectedItem=a.model.item}_showCreateDialog(){this.sponsorData={},this.$.sponsorDoc.reset(),this.$.sponsorDialog.open()}_showEditDialog(a){this.$.sponsorDoc.data=Object.assign({},a.model.item),this.$.sponsorDialog.open()}_create(){if(this.$.name.validate(),this.$.level.validate(),this.$.url.validate(),!this.$.name.invalid&&!this.$.level.invalid&&!this.$.url.invalid){if(!this.sponsorData.$key)return this.$.sponsorDoc.saveValue(this.conf+'/sponsors/inactive').then(function(){this.$.sponsorDoc.reset(),this.$.grid.clearCache(),this.$.sponsorDialog.close()}.bind(this));var a=Object.assign({},this.sponsorData);delete a.$key;var b=this._filterActive?'active/':'inactive/';return this.$.sponsorsQuery.ref.child(b+this.sponsorData.$key).set(a).then(function(){this.$.sponsorDoc.reset(),this.$.grid.clearCache(),this.$.sponsorDialog.close()}.bind(this))}}_delete(){return this.$.sponsorsQuery.ref.child('inactive/'+this._selectedItem.$key).set(null).then(function(){this.$.sponsorDoc.reset(),this._selectedItem=null,this.$.grid.clearCache()}.bind(this))}activeSocial(a){return!a}_trimText(a){var b=10;return a?a.length>b?a.substring(0,b-3)+'...':a:null}_removeSponsorImage(a){this._removeImage('sponsorImage',a)}_removeImage(a,b){this.sponsorData=b.model.item,delete this.sponsorData[a],this.sponsorData=JSON.parse(JSON.stringify(this.sponsorData)),this._savesponsorData()}_setSelectedLevel(a){var b;return levels.forEach(function(c,d){c.name===a&&(b=d)}),b}}window.customElements.define(SocmovAdminSponsors.is,SocmovAdminSponsors);</script></dom-module></body></html>