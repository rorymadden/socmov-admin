<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-fab/paper-fab.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-item/paper-item.html"><link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html"><link rel="import" href="../bower_components/paper-input/paper-textarea.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html"><link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html"><link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/social-media-icons/social-media-icons.html"><link rel="import" href="../bower_components/file-fire/file-fire.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/app-route/app-location.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="socmov-admin-agenda-sessions"><template><style include="shared-styles iron-flex iron-flex-alignment">:host{display:block;padding:10px;}h1{margin:16px 50px 16px 0px;}paper-button{margin-top:10px;}.primaryButton{background-color:var(--paper-blue-500);color:white;}.form{padding:20px;}social-media-icons{padding:5px;}social-media-icons.inactive{color:grey;}paper-toggle-button{display:inline-block;}paper-icon-button[hidden], social-media-icons[hidden]{display:none;}.page-header{@apply --layout-horizontal;}.page-filter{padding:20px 20px 0px 0px;}.companyImage{max-height:30px;width:auto;height:auto;}#agendaSessionDialog{width:calc(100vw - 100px);height:calc(100vh - 150px);margin:0;padding:0;top:100px;}</style><app-location route="{{route}}"></app-location><app-route route="{{route}}" pattern="/agenda-sessions" data="{{routeData}}" tail="{{subroute}}"></app-route><app-route route="{{subroute}}" pattern="/:agendaKey" data="{{subrouteData}}"></app-route><firebase-document path="{{conf}}/agendas/active/{{subrouteData.agendaKey}}" app-name="socmov" data="{{agendaDoc}}"></firebase-document><firebase-document id="agendaSessionDoc" app-name="socmov" data="{{agendaSessionData}}"></firebase-document><firebase-query id="sessionsQuery" app-name="socmov" path="{{conf}}/sessions/active" data="{{sessionsList}}"></firebase-query><firebase-query id="agendaSessionsQuery" app-name="socmov" path="{{conf}}/agendas/active/{{subrouteData.agendaKey}}/sessions" data="{{agendaSessionsList}}"></firebase-query><paper-dialog id="agendaSessionDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Agenda Session</h2><div class="layout vertical form"><div class="horizontal layout around-justified wrap"><paper-dropdown-menu id="name" label="Session" value="{{agendaSessionData.sessionName}}"><paper-listbox slot="dropdown-content" selected="{{_setSelectedSession(agendaSessionData.sessionKey)}}"><template is="dom-repeat" items="[[sessionsList]]"><paper-item>[[item.name]]</paper-item></template></paper-listbox></paper-dropdown-menu><paper-dropdown-menu id="type" label="Type" required="" error-message="Please select a type" value="{{agendaSessionData.type}}"><paper-listbox slot="dropdown-content" selected="{{_setSelectedIndex(agendaSessionData.type, types)}}"><template is="dom-repeat" items="[[types]]"><paper-item>[[item]]</paper-item></template></paper-listbox></paper-dropdown-menu><paper-dropdown-menu id="stream" label="Stream" value="{{agendaSessionData.stream}}"><paper-listbox slot="dropdown-content" selected="{{_setSelectedIndex(agendaSessionData.stream, agendaDoc.streams)}}"><template is="dom-repeat" items="[[agendaDoc.streams]]"><paper-item>[[item]]</paper-item></template></paper-listbox></paper-dropdown-menu><paper-input id="startTime" type="time" label="Start Time" required="" error-message="Please enter a start time" value="{{agendaSessionData.startTime}}"></paper-input><paper-input id="duration" type="number" label="Duration" required="" error-message="Please enter a duration" value="{{agendaSessionData.duration}}"></paper-input></div></div><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button class="primaryButton" on-tap="_create">Save</paper-button></div></paper-dialog><div class="card"><div class="page-header"><div><h1>[[agendaDoc.name]] Agenda: Sessions</h1></div><div><paper-button on-tap="_showCreateDialog" disabled="[[!online]]" aria-label="Add agendaSession" class="primaryButton">Create New</paper-button></div></div><vaadin-grid aria-label="agendaSessions" items="[[sortedAgendaSessionsList]]" id="grid"><vaadin-grid-column><template class="header">Name</template><template>[[item.sessionName]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Stream</template><template>[[item.stream]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Type</template><template>[[item.type]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Start Time</template><template>[[item.startTime]]</template></vaadin-grid-column><vaadin-grid-column><template class="header">Duration</template><template>[[item.duration]]</template></vaadin-grid-column><vaadin-grid-column><template><div style="display: flex"><paper-icon-button icon="icons:create" on-tap="_showEditDialog" focus-target$="[[!editing]]"></paper-icon-button><paper-icon-button icon="icons:delete-forever" hidden$="[[item.active]]" on-tap="_showConfirmDialog"></paper-icon-button></div></template></vaadin-grid-column></vaadin-grid></div><paper-dialog id="confirmDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation"><h2>Are you sure you want to delete the record?</h2><paper-dialog-scrollable>This is final - you can't get it back!</paper-dialog-scrollable><div class="buttons"><paper-button dialog-dismiss="">Cancel</paper-button><paper-button dialog-confirm="" autofocus="" on-tap="_delete">Accept</paper-button></div></paper-dialog></template><script>var types=['session','keynote','break'];class SocmovAdminAgendaSessions extends Polymer.Element{static get is(){return'socmov-admin-agenda-sessions'}static get properties(){return{agendaDoc:{type:Object},agendaSessionsList:{type:Object},sortedAgendaSessionsList:Object,agendaSessionData:{type:Object,value:function(){return{}}},activeString:String,sessionsList:Array,_selectedItem:Object,agenda:{type:String,reflectToAttribute:!0,observer:'_pageChanged'},types:{type:Array,value:types}}}static get observers(){return['_sortSessions(agendaSessionsList.length, sessionsList.length)']}_sortSessions(){return this.agendaSessionsList?void(this.sortedAgendaSessionsList=this.agendaSessionsList.sort(function(c,d){return c.startTime<d.startTime?-1:c.startTime>d.startTime?1:0}),this.sortedAgendaSessionsList.forEach(function(c){c.sessionName=this._getSessionName(c.sessionKey)}.bind(this)),this.$.grid.clearCache()):this.sortedAgendaSessionsList=[]}_showConfirmDialog(c){this.$.confirmDialog.open(),this._selectedItem=c.model.item}_showCreateDialog(){this.agendaSessionData={},this.$.agendaSessionDoc.reset(),this.$.agendaSessionDialog.open()}_showEditDialog(c){this.$.agendaSessionDoc.data=Object.assign({},c.model.item),this.$.agendaSessionDialog.open()}_create(){if(this.$.type.validate(),this.$.startTime.validate(),this.$.duration.validate(),!this.$.type.invalid&&!this.$.startTime.invalid&&!this.$.duration.invalid){if(this.agendaSessionData.sessionKey=this._setSessionValue(this.agendaSessionData.sessionName),delete this.agendaSessionData.sessionName,!this.agendaSessionData.$key)return this.$.agendaSessionDoc.saveValue(this.conf+'/agendas/active/'+this.subrouteData.agendaKey+'/sessions').then(function(){this.$.agendaSessionDoc.reset(),this._sortSessions(),this.$.agendaSessionDialog.close()}.bind(this));var c=Object.assign({},this.agendaSessionData);return delete c.$key,this.$.agendaSessionsQuery.ref.child(this.agendaSessionData.$key).set(c).then(function(){this.$.agendaSessionDoc.reset(),this._sortSessions(),this.$.agendaSessionDialog.close()}.bind(this))}}_delete(){return this.$.agendaSessionsQuery.ref.child(this._selectedItem.$key).set(null).then(function(){this.$.agendaSessionDoc.reset(),this._selectedItem=null,this.$.grid.clearCache()}.bind(this))}_setSessionValue(c){console.log(c,this.sessionsList);var d=null;return this.sessionsList?(this.sessionsList.forEach(function(f){f.name.trim()===c.trim()&&(d=f.$key)}),d):null}_getSessionName(c){var d;return this.sessionsList?(this.sessionsList.forEach(function(f){f.$key===c&&(d=f.name)}),d):null}_setSelectedSession(c){var d;return this.sessionsList?(this.sessionsList.forEach(function(f,g){f.$key===c&&(d=g)}),d):null}_setSelectedIndex(c,d){var f;return d?(d.forEach(function(g,h){g===c&&(f=h)}),f):null}}window.customElements.define(SocmovAdminAgendaSessions.is,SocmovAdminAgendaSessions);</script></dom-module></body></html>