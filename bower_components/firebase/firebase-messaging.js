try{webpackJsonpFirebase([1],[,,,,,function(b,j){"use strict";function m(y,z,A){return z in y?Object.defineProperty(y,z,{value:A,enumerable:!0,configurable:!0,writable:!0}):y[z]=A,y}Object.defineProperty(j,"__esModule",{value:!0});var q,w={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key"},x=(q={},m(q,w.AVAILABLE_IN_WINDOW,"This method is available in a Window context."),m(q,w.AVAILABLE_IN_SW,"This method is available in a service worker context."),m(q,w.SHOULD_BE_INHERITED,"This method should be overriden by extended classes."),m(q,w.BAD_SENDER_ID,"Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp()."),m(q,w.PERMISSION_DEFAULT,"The required permissions were not granted and dismissed instead."),m(q,w.PERMISSION_BLOCKED,"The required permissions were not granted and blocked instead."),m(q,w.UNSUPPORTED_BROWSER,"This browser doesn't support the API's required to use the firebase SDK."),m(q,w.NOTIFICATIONS_BLOCKED,"Notifications have been blocked."),m(q,w.FAILED_DEFAULT_REGISTRATION,"We are unable to register the default service worker. {$browserErrorMessage}"),m(q,w.SW_REGISTRATION_EXPECTED,"A service worker registration was the expected input."),m(q,w.GET_SUBSCRIPTION_FAILED,"There was an error when trying to get any existing Push Subscriptions."),m(q,w.INVALID_SAVED_TOKEN,"Unable to access details of the saved token."),m(q,w.SW_REG_REDUNDANT,"The service worker being used for push was made redundant."),m(q,w.TOKEN_SUBSCRIBE_FAILED,"A problem occured while subscribing the user to FCM: {$message}"),m(q,w.TOKEN_SUBSCRIBE_NO_TOKEN,"FCM returned no token when subscribing the user to push."),m(q,w.TOKEN_SUBSCRIBE_NO_PUSH_SET,"FCM returned an invalid response when getting an FCM token."),m(q,w.USE_SW_BEFORE_GET_TOKEN,"You must call useServiceWorker() before calling getToken() to ensure your service worker is used."),m(q,w.INVALID_DELETE_TOKEN,"You must pass a valid token into deleteToken(), i.e. the token from getToken()."),m(q,w.DELETE_TOKEN_NOT_FOUND,"The deletion attempt for token could not be performed as the token was not found."),m(q,w.DELETE_SCOPE_NOT_FOUND,"The deletion attempt for service worker scope could not be performed as the scope was not found."),m(q,w.BG_HANDLER_FUNCTION_EXPECTED,"The input to setBackgroundMessageHandler() must be a function."),m(q,w.NO_WINDOW_CLIENT_TO_MSG,"An attempt was made to message a non-existant window client."),m(q,w.UNABLE_TO_RESUBSCRIBE,"There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}"),m(q,w.NO_FCM_TOKEN_FOR_RESUBSCRIBE,"Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit."),m(q,w.FAILED_TO_DELETE_TOKEN,"Unable to delete the currently saved token."),m(q,w.NO_SW_IN_REG,"Even though the service worker registration was successful, there was a problem accessing the service worker itself."),m(q,w.INCORRECT_GCM_SENDER_ID,"Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging."),m(q,w.BAD_SCOPE,"The service worker scope must be a string with at least one character."),m(q,w.BAD_VAPID_KEY,"The public VAPID key must be a string with at least one character."),m(q,w.BAD_SUBSCRIPTION,"The subscription must be a valid PushSubscription."),m(q,w.BAD_TOKEN,"The FCM Token used for storage / lookup was not a valid token string."),m(q,w.BAD_PUSH_SET,"The FCM push set used for storage / lookup was not not a valid push set string."),m(q,w.FAILED_DELETE_VAPID_KEY,"The VAPID key could not be deleted."),q);j.default={codes:w,map:x},b.exports=j.default},,,,,,,,,,,,,function(b,j,k){"use strict";function m(H){return H&&H.__esModule?H:{default:H}}function q(H,I){if(!(H instanceof I))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(j,"__esModule",{value:!0});var w=function(){function H(I,J){for(var L,K=0;K<J.length;K++)L=J[K],L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(I,L.key,L)}return function(I,J,K){return J&&H(I.prototype,J),K&&H(I,K),I}}(),x=k(9),y=k(5),z=m(y),A=k(36),B=m(A),C=k(20),D=m(C),F="messagingSenderId",G=function(){function H(I){var J=this;if(q(this,H),this.errorFactory_=new x.ErrorFactory("messaging","Messaging",z.default.map),!I.options[F]||"string"!=typeof I.options[F])throw this.errorFactory_.create(z.default.codes.BAD_SENDER_ID);this.messagingSenderId_=I.options[F],this.tokenManager_=new B.default,this.app=I,this.INTERNAL={},this.INTERNAL.delete=function(){return J.delete}}return w(H,[{key:"getToken",value:function(){var I=this,J=this.getNotificationPermission_();return J===D.default.granted?this.getSWRegistration_().then(function(K){return I.tokenManager_.getSavedToken(I.messagingSenderId_,K).then(function(L){return L||I.tokenManager_.createToken(I.messagingSenderId_,K)})}):J===D.default.denied?Promise.reject(this.errorFactory_.create(z.default.codes.NOTIFICATIONS_BLOCKED)):Promise.resolve(null)}},{key:"deleteToken",value:function(I){var J=this;return this.tokenManager_.deleteToken(I).then(function(){return J.getSWRegistration_().then(function(K){if(K)return K.pushManager.getSubscription()}).then(function(K){if(K)return K.unsubscribe()})})}},{key:"getSWRegistration_",value:function(){throw this.errorFactory_.create(z.default.codes.SHOULD_BE_INHERITED)}},{key:"requestPermission",value:function(){throw this.errorFactory_.create(z.default.codes.AVAILABLE_IN_WINDOW)}},{key:"useServiceWorker",value:function(){throw this.errorFactory_.create(z.default.codes.AVAILABLE_IN_WINDOW)}},{key:"onMessage",value:function(){throw this.errorFactory_.create(z.default.codes.AVAILABLE_IN_WINDOW)}},{key:"onTokenRefresh",value:function(){throw this.errorFactory_.create(z.default.codes.AVAILABLE_IN_WINDOW)}},{key:"setBackgroundMessageHandler",value:function(){throw this.errorFactory_.create(z.default.codes.AVAILABLE_IN_SW)}},{key:"delete",value:function(){this.tokenManager_.closeDatabase()}},{key:"getNotificationPermission_",value:function(){return Notification.permission}},{key:"getTokenManager",value:function(){return this.tokenManager_}}]),H}();j.default=G,b.exports=j.default},function(b,j){"use strict";Object.defineProperty(j,"__esModule",{value:!0});var m=[4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110],q={userVisibleOnly:!0,applicationServerKey:new Uint8Array(m)};j.default={ENDPOINT:"https://fcm.googleapis.com",APPLICATION_SERVER_KEY:m,SUBSCRIPTION_OPTIONS:q},b.exports=j.default},function(b,j){"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.default={granted:"granted",default:"default",denied:"denied"},b.exports=j.default},function(b,j){"use strict";function m(y,z,A){return z in y?Object.defineProperty(y,z,{value:A,enumerable:!0,configurable:!0,writable:!0}):y[z]=A,y}Object.defineProperty(j,"__esModule",{value:!0});var q={TYPE_OF_MSG:"firebase-messaging-msg-type",DATA:"firebase-messaging-msg-data"};j.default={PARAMS:q,TYPES_OF_MSG:{PUSH_MSG_RECEIVED:"push-msg-received",NOTIFICATION_CLICKED:"notification-clicked"},createNewMsg:function(y,z){var A;return A={},m(A,q.TYPE_OF_MSG,y),m(A,q.DATA,z),A}},b.exports=j.default},,,,,,,function(b,j,k){"use strict";function m(L){return L&&L.__esModule?L:{default:L}}function q(L,M,N){return M in L?Object.defineProperty(L,M,{value:N,enumerable:!0,configurable:!0,writable:!0}):L[M]=N,L}function w(L,M){if(!(L instanceof M))throw new TypeError("Cannot call a class as a function")}function x(L,M){if(!L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return M&&("object"==typeof M||"function"==typeof M)?M:L}function y(L,M){if("function"!=typeof M&&null!==M)throw new TypeError("Super expression must either be null or a function, not "+typeof M);L.prototype=Object.create(M&&M.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),M&&(Object.setPrototypeOf?Object.setPrototypeOf(L,M):L.__proto__=M)}Object.defineProperty(j,"__esModule",{value:!0});var z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(L){return typeof L}:function(L){return L&&"function"==typeof Symbol&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},A=function(){function L(M,N){for(var P,O=0;O<N.length;O++)P=N[O],P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(M,P.key,P)}return function(M,N,O){return N&&L(M.prototype,N),O&&L(M,O),M}}(),B=k(18),C=m(B),D=k(5),F=m(D),G=k(21),H=m(G),I=k(19),J=m(I),K=function(L){function M(N){w(this,M);var O=x(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,N));return self.addEventListener("push",function(P){return O.onPush_(P)},!1),self.addEventListener("pushsubscriptionchange",function(P){return O.onSubChange_(P)},!1),self.addEventListener("notificationclick",function(P){return O.onNotificationClick_(P)},!1),O.bgMessageHandler_=null,O}return y(M,L),A(M,[{key:"onPush_",value:function(N){var O=this,P;try{P=N.data.json()}catch(R){return}var Q=this.hasVisibleClients_().then(function(R){if(!R){var U=O.getNotificationData_(P);if(U){var V=U.title||"";return self.registration.showNotification(V,U)}if(O.bgMessageHandler_)return O.bgMessageHandler_(P)}else if(P.notification||O.bgMessageHandler_)return O.sendMessageToWindowClients_(P)});N.waitUntil(Q)}},{key:"onSubChange_",value:function(N){var O=this,P=this.getToken().then(function(Q){if(!Q)throw O.errorFactory_.create(F.default.codes.NO_FCM_TOKEN_FOR_RESUBSCRIBE);var R=null,U=O.getTokenManager();return U.getTokenDetailsFromToken(Q).then(function(V){if(!(R=V))throw O.errorFactory_.create(F.default.codes.INVALID_SAVED_TOKEN);return self.registration.pushManager.subscribe(J.default.SUBSCRIPTION_OPTIONS)}).then(function(V){return U.subscribeToFCM(R.fcmSenderId,V,R.fcmPushSet)}).catch(function(V){return U.deleteToken(R.fcmToken).then(function(){throw O.errorFactory_.create(F.default.codes.UNABLE_TO_RESUBSCRIBE,{message:V})})})});N.waitUntil(P)}},{key:"onNotificationClick_",value:function(N){var O=this;if(N.notification&&N.notification.data&&N.notification.data.FCM_MSG){N.stopImmediatePropagation(),N.notification.close();var P=N.notification.data.FCM_MSG,Q=P.notification.click_action;if(Q){var R=this.getWindowClient_(Q).then(function(U){return U||self.clients.openWindow(Q)}).then(function(U){if(U){P.notification,delete P.notification;var V=H.default.createNewMsg(H.default.TYPES_OF_MSG.NOTIFICATION_CLICKED,P);return O.attemptToMessageClient_(U,V)}});N.waitUntil(R)}}}},{key:"getNotificationData_",value:function(N){if(N&&"object"===z(N.notification)){var O=Object.assign({},N.notification);return O.data=q({},"FCM_MSG",N),O}}},{key:"setBackgroundMessageHandler",value:function(N){if(N&&"function"!=typeof N)throw this.errorFactory_.create(F.default.codes.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler_=N}},{key:"getWindowClient_",value:function(N){var O=new URL(N).href;return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(P){for(var Q=null,R=0;R<P.length;R++)if(new URL(P[R].url).href===O){Q=P[R];break}if(Q)return Q.focus(),Q})}},{key:"attemptToMessageClient_",value:function(N,O){var P=this;return new Promise(function(Q,R){return N?void(N.postMessage(O),Q()):R(P.errorFactory_.create(F.default.codes.NO_WINDOW_CLIENT_TO_MSG))})}},{key:"hasVisibleClients_",value:function(){return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(N){return N.some(function(O){return"visible"===O.visibilityState})})}},{key:"sendMessageToWindowClients_",value:function(N){var O=this;return self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(P){var Q=H.default.createNewMsg(H.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED,N);return Promise.all(P.map(function(R){return O.attemptToMessageClient_(R,Q)}))})}},{key:"getSWRegistration_",value:function(){return Promise.resolve(self.registration)}}]),M}(C.default);j.default=K,b.exports=j.default},function(b,j,k){"use strict";function m(N){return N&&N.__esModule?N:{default:N}}function q(N,O){if(!(N instanceof O))throw new TypeError("Cannot call a class as a function")}function w(N,O){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O&&("object"==typeof O||"function"==typeof O)?O:N}function x(N,O){if("function"!=typeof O&&null!==O)throw new TypeError("Super expression must either be null or a function, not "+typeof O);N.prototype=Object.create(O&&O.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(N,O):N.__proto__=O)}Object.defineProperty(j,"__esModule",{value:!0});var y=function(){function N(O,P){for(var R,Q=0;Q<P.length;Q++)R=P[Q],R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(O,R.key,R)}return function(O,P,Q){return P&&N(O.prototype,P),Q&&N(O,Q),O}}(),z=function N(O,P,Q){null===O&&(O=Function.prototype);var R=Object.getOwnPropertyDescriptor(O,P);if(void 0===R){var U=Object.getPrototypeOf(O);return null===U?void 0:N(U,P,Q)}if("value"in R)return R.value;var V=R.get;if(void 0!==V)return V.call(Q)},A=k(18),B=m(A),C=k(5),D=m(C),F=k(21),G=m(F),H=k(35),I=m(H),J=k(20),K=m(J),L=k(17),M=function(N){function O(P){q(this,O);var Q=w(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,P));return Q.registrationToUse_,Q.manifestCheckPromise_,Q.messageObserver_=null,Q.onMessage_=(0,L.createSubscribe)(function(R){Q.messageObserver_=R}),Q.tokenRefreshObserver_=null,Q.onTokenRefresh_=(0,L.createSubscribe)(function(R){Q.tokenRefreshObserver_=R}),Q.setupSWMessageListener_(),Q}return x(O,N),y(O,[{key:"getToken",value:function(){var P=this;return this.isSupported_()?this.manifestCheck_().then(function(){return z(O.prototype.__proto__||Object.getPrototypeOf(O.prototype),"getToken",P).call(P)}):Promise.reject(this.errorFactory_.create(D.default.codes.UNSUPPORTED_BROWSER))}},{key:"manifestCheck_",value:function(){var P=this;if(this.manifestCheckPromise_)return this.manifestCheckPromise_;var Q=document.querySelector("link[rel=\"manifest\"]");return this.manifestCheckPromise_=Q?fetch(Q.href).then(function(R){return R.json()}).catch(function(){return Promise.resolve()}).then(function(R){if(R&&R.gcm_sender_id&&"103953800507"!==R.gcm_sender_id)throw P.errorFactory_.create(D.default.codes.INCORRECT_GCM_SENDER_ID)}):Promise.resolve(),this.manifestCheckPromise_}},{key:"requestPermission",value:function(){var P=this;return Notification.permission===K.default.granted?Promise.resolve():new Promise(function(Q,R){var U=function(W){return W===K.default.granted?Q():R(W===K.default.denied?P.errorFactory_.create(D.default.codes.PERMISSION_BLOCKED):P.errorFactory_.create(D.default.codes.PERMISSION_DEFAULT))},V=Notification.requestPermission(function(W){V||U(W)});V&&V.then(U)})}},{key:"useServiceWorker",value:function(P){if(!(P instanceof ServiceWorkerRegistration))throw this.errorFactory_.create(D.default.codes.SW_REGISTRATION_EXPECTED);if(void 0!==this.registrationToUse_)throw this.errorFactory_.create(D.default.codes.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse_=P}},{key:"onMessage",value:function(P,Q,R){return this.onMessage_(P,Q,R)}},{key:"onTokenRefresh",value:function(P,Q,R){return this.onTokenRefresh_(P,Q,R)}},{key:"waitForRegistrationToActivate_",value:function(P){var Q=this,R=P.installing||P.waiting||P.active;return new Promise(function(U,V){if(!R)return void V(Q.errorFactory_.create(D.default.codes.NO_SW_IN_REG));if("activated"===R.state)return void U(P);if("redundant"===R.state)return void V(Q.errorFactory_.create(D.default.codes.SW_REG_REDUNDANT));var W=function(){if("activated"===R.state)U(P);else{if("redundant"!==R.state)return;V(Q.errorFactory_.create(D.default.codes.SW_REG_REDUNDANT))}R.removeEventListener("statechange",W)};R.addEventListener("statechange",W)})}},{key:"getSWRegistration_",value:function(){var P=this;return this.registrationToUse_?this.waitForRegistrationToActivate_(this.registrationToUse_):(this.registrationToUse_=null,navigator.serviceWorker.register(I.default.path,{scope:I.default.scope}).catch(function(Q){throw P.errorFactory_.create(D.default.codes.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:Q.message})}).then(function(Q){return P.waitForRegistrationToActivate_(Q).then(function(){return P.registrationToUse_=Q,Q.update(),Q})}))}},{key:"setupSWMessageListener_",value:function(){var P=this;"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",function(Q){if(Q.data&&Q.data[G.default.PARAMS.TYPE_OF_MSG]){var R=Q.data;switch(R[G.default.PARAMS.TYPE_OF_MSG]){case G.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED:case G.default.TYPES_OF_MSG.NOTIFICATION_CLICKED:var U=R[G.default.PARAMS.DATA];P.messageObserver_.next(U);}}},!1)}},{key:"isSupported_",value:function(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}}]),O}(B.default);j.default=M,b.exports=j.default},,,,function(b,j,k){"use strict";function m(A){return A&&A.__esModule?A:{default:A}}function q(A){A.INTERNAL.registerService("messaging",function(B){return self&&"ServiceWorkerGlobalScope"in self?new z.default(B):new x.default(B)},{Messaging:x.default})}Object.defineProperty(j,"__esModule",{value:!0}),j.registerMessaging=q;var w=k(29),x=m(w),y=k(28),z=m(y);q(m(k(4)).default)},function(b,j){"use strict";function m(q){var w=new Uint8Array(q);return window.btoa(String.fromCharCode.apply(null,w))}Object.defineProperty(j,"__esModule",{value:!0}),j.default=function(q){return m(q).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},b.exports=j.default},function(b,j){"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.default={path:"/firebase-messaging-sw.js",scope:"/firebase-cloud-messaging-push-scope"},b.exports=j.default},function(b,j,k){"use strict";function m(H){return H&&H.__esModule?H:{default:H}}function q(H,I){if(!(H instanceof I))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(j,"__esModule",{value:!0});var w=function(){function H(I,J){for(var L,K=0;K<J.length;K++)L=J[K],L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(I,L.key,L)}return function(I,J,K){return J&&H(I.prototype,J),K&&H(I,K),I}}(),x=k(9),y=k(5),z=m(y),A=k(34),B=m(A),C=k(19),D=m(C),F="fcm_token_object_Store",G=function(){function H(){q(this,H),this.errorFactory_=new x.ErrorFactory("messaging","Messaging",z.default.map),this.openDbPromise_=null}return w(H,[{key:"openDatabase_",value:function(){return this.openDbPromise_?this.openDbPromise_:(this.openDbPromise_=new Promise(function(I,J){var K=indexedDB.open("fcm_token_details_db",1);K.onerror=function(L){J(L.target.error)},K.onsuccess=function(L){I(L.target.result)},K.onupgradeneeded=function(L){var M=L.target.result,N=M.createObjectStore(F,{keyPath:"swScope"});N.createIndex("fcmSenderId","fcmSenderId",{unique:!1}),N.createIndex("fcmToken","fcmToken",{unique:!0})}}),this.openDbPromise_)}},{key:"closeDatabase",value:function(){var I=this;return this.openDbPromise_?this.openDbPromise_.then(function(J){J.close(),I.openDbPromise_=null}):Promise.resolve()}},{key:"getTokenDetailsFromToken",value:function(I){return this.openDatabase_().then(function(J){return new Promise(function(K,L){var M=J.transaction([F]),N=M.objectStore(F),O=N.index("fcmToken"),P=O.get(I);P.onerror=function(Q){L(Q.target.error)},P.onsuccess=function(Q){K(Q.target.result)}})})}},{key:"getTokenDetailsFromSWScope_",value:function(I){return this.openDatabase_().then(function(J){return new Promise(function(K,L){var M=J.transaction([F]),N=M.objectStore(F),O=N.get(I);O.onerror=function(P){L(P.target.error)},O.onsuccess=function(P){K(P.target.result)}})})}},{key:"getAllTokenDetailsForSenderId_",value:function(I){return this.openDatabase_().then(function(J){return new Promise(function(K,L){var M=J.transaction([F]),N=M.objectStore(F),O=[],P=N.openCursor();P.onerror=function(Q){L(Q.target.error)},P.onsuccess=function(Q){var R=Q.target.result;R?(R.value.fcmSenderId===I&&O.push(R.value),R.continue()):K(O)}})})}},{key:"subscribeToFCM",value:function(I,J,K){var L=this,M=(0,B.default)(J.getKey("p256dh")),N=(0,B.default)(J.getKey("auth")),O="authorized_entity="+I+"&endpoint="+J.endpoint+"&encryption_key="+M+"&encryption_auth="+N;K&&(O+="&pushSet="+K);var P=new Headers;P.append("Content-Type","application/x-www-form-urlencoded");var Q={method:"POST",headers:P,body:O};return fetch(D.default.ENDPOINT+"/fcm/connect/subscribe",Q).then(function(R){return R.json()}).then(function(R){var U=R;if(U.error){var V=U.error.message;throw L.errorFactory_.create(z.default.codes.TOKEN_SUBSCRIBE_FAILED,{message:V})}if(!U.token)throw L.errorFactory_.create(z.default.codes.TOKEN_SUBSCRIBE_NO_TOKEN);if(!U.pushSet)throw L.errorFactory_.create(z.default.codes.TOKEN_SUBSCRIBE_NO_PUSH_SET);return{token:U.token,pushSet:U.pushSet}})}},{key:"isSameSubscription_",value:function(I,J){return I.endpoint===J.endpoint&&(0,B.default)(I.getKey("auth"))===J.auth&&(0,B.default)(I.getKey("p256dh"))===J.p256dh}},{key:"saveTokenDetails_",value:function(I,J,K,L,M){var N={swScope:J.scope,endpoint:K.endpoint,auth:(0,B.default)(K.getKey("auth")),p256dh:(0,B.default)(K.getKey("p256dh")),fcmToken:L,fcmPushSet:M,fcmSenderId:I};return this.openDatabase_().then(function(O){return new Promise(function(P,Q){var R=O.transaction([F],"readwrite"),U=R.objectStore(F),V=U.put(N);V.onerror=function(W){Q(W.target.error)},V.onsuccess=function(){P()}})})}},{key:"getSavedToken",value:function(I,J){var K=this;return J instanceof ServiceWorkerRegistration?"string"!=typeof I||0===I.length?Promise.reject(this.errorFactory_.create(z.default.codes.BAD_SENDER_ID)):this.getAllTokenDetailsForSenderId_(I).then(function(L){if(0!==L.length){var M=L.findIndex(function(N){return J.scope===N.swScope&&I===N.fcmSenderId});if(-1!==M)return L[M]}}).then(function(L){if(L)return J.pushManager.getSubscription().catch(function(){throw K.errorFactory_.create(z.default.codes.GET_SUBSCRIPTION_FAILED)}).then(function(M){if(M&&K.isSameSubscription_(M,L))return L.fcmToken})}):Promise.reject(this.errorFactory_.create(z.default.codes.SW_REGISTRATION_EXPECTED))}},{key:"createToken",value:function(I,J){var K=this;if("string"!=typeof I||0===I.length)return Promise.reject(this.errorFactory_.create(z.default.codes.BAD_SENDER_ID));if(!(J instanceof ServiceWorkerRegistration))return Promise.reject(this.errorFactory_.create(z.default.codes.SW_REGISTRATION_EXPECTED));var L,M;return J.pushManager.getSubscription().then(function(N){return N||J.pushManager.subscribe(D.default.SUBSCRIPTION_OPTIONS)}).then(function(N){return L=N,K.subscribeToFCM(I,L)}).then(function(N){return M=N,K.saveTokenDetails_(I,J,L,M.token,M.pushSet)}).then(function(){return M.token})}},{key:"deleteToken",value:function(I){var J=this;return"string"!=typeof I||0===I.length?Promise.reject(this.errorFactory_.create(z.default.codes.INVALID_DELETE_TOKEN)):this.getTokenDetailsFromToken(I).then(function(K){if(!K)throw J.errorFactory_.create(z.default.codes.DELETE_TOKEN_NOT_FOUND);return J.openDatabase_().then(function(L){return new Promise(function(M,N){var O=L.transaction([F],"readwrite"),P=O.objectStore(F),Q=P.delete(K.swScope);Q.onerror=function(R){N(R.target.error)},Q.onsuccess=function(R){return 0===R.target.result?void N(J.errorFactory_.create(z.default.codes.FAILED_TO_DELETE_TOKEN)):void M(K)}})})})}}]),H}();j.default=G,b.exports=j.default}],[33])}catch(b){throw new Error("Cannot instantiate firebase-messaging.js - be sure to load firebase-app.js first.")}