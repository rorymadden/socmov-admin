<html><head><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="vaadin-date-picker-helper.html"><script>window.Vaadin=window.Vaadin||{},Vaadin.DatePickerMixin=c=>class extends Polymer.mixinBehaviors([Polymer.IronA11yKeysBehavior,Polymer.IronResizableBehavior],c){static get properties(){return{_selectedDate:{type:Date},_focusedDate:Date,value:{type:String,observer:'_valueChanged',notify:!0,value:''},required:{type:Boolean,value:!1},name:{type:String},hasValue:{type:Boolean,computed:'_hasValue(value)',reflectToAttribute:!0},initialPosition:String,label:String,opened:{type:Boolean,reflectToAttribute:!0,notify:!0},showWeekNumbers:{type:Boolean},_fullscreen:{value:!1,observer:'_fullscreenChanged'},_fullscreenMediaQuery:{value:'(max-width: 420px), (max-height: 420px)'},_touchPrevented:Array,i18n:{type:Object,value:()=>{return{monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],weekdays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],weekdaysShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],firstDayOfWeek:0,week:'Week',calendar:'Calendar',clear:'Clear',today:'Today',cancel:'Cancel',formatDate:g=>{var h=g.getFullYear(),j=h.toString();return 3>j.length&&0<=h&&(j=(10>h?'000':'00')+h),g.getMonth()+1+'/'+g.getDate()+'/'+j},parseDate:g=>{var l,h=g.split('/'),j=new Date,m=j.getMonth(),n=j.getFullYear();if(3===h.length?(n=parseInt(h[2]),3>h[2].length&&0<=n&&(n+=50>n?2e3:1900),m=parseInt(h[0])-1,l=parseInt(h[1])):2===h.length?(m=parseInt(h[0])-1,l=parseInt(h[1])):1===h.length&&(l=parseInt(h[0])),void 0!==l){var o=new Date(0,0);return o.setFullYear(n),o.setMonth(m),o.setDate(l),o}},formatTitle:(g,h)=>{return g+' '+h}}}},min:{type:String,observer:'_minChanged'},max:{type:String,observer:'_maxChanged'},_minDate:{type:Date,value:''},_maxDate:{type:Date,value:''},_noInput:{type:Boolean,computed:'_isNoInput(_fullscreen, i18n, i18n.*, _ios)'},_ios:{type:Boolean,value:navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/)},_ignoreAnnounce:{value:!0},_focusOverlayOnOpen:Boolean,_documentPointerEvents:String}}static get observers(){return['_selectedDateChanged(_selectedDate, i18n.formatDate)','_validateInput(_selectedDate, _minDate, _maxDate)','_focusedDateChanged(_focusedDate, i18n.formatDate)','_announceFocusedDate(_focusedDate, opened, _ignoreAnnounce)']}ready(){super.ready(),this._boundOnScroll=this._onScroll.bind(this),this.addEventListener('tap',this.open.bind(this)),this.addEventListener('touchend',this._preventDefault.bind(this)),this.addEventListener('keydown',this._onKeydown.bind(this)),this.addEventListener('close',this._close.bind(this)),this.addEventListener('date-tap',this._close.bind(this)),this.addEventListener('focus-input',this._focusAndSelect.bind(this)),this.addEventListener('input',this._onUserInput.bind(this))}open(){this.disabled||this.readonly||(this.$.dropdown.open(),this._updateAlignmentAndPosition())}_close(g){g&&g.stopPropagation(),this._focus(),this.close()}close(){this.$.dropdown.close()}get _inputElement(){return this._input()}get _nativeInput(){if(this._inputElement)return this._inputElement.focusElement?this._inputElement.focusElement:this._inputElement.inputElement?this._inputElement.inputElement:window.unwrap?window.unwrap(this._inputElement):this._inputElement}_parseDate(g){var h=/^(\d{4}|[-+]\d{6})-(\d{2})-(\d{2})$/.exec(g);if(h){var j=new Date(0,0);return j.setFullYear(parseInt(h[1],10)),j.setMonth(parseInt(h[2],10)-1),j.setDate(parseInt(h[3],10)),j}}_isNoInput(){return!this._inputElement||this._fullscreen||!this.i18n.parseDate||this._ios}_formatISO(g){return g instanceof Date?new Date(g.getTime()-6e4*g.getTimezoneOffset()).toISOString().split('T')[0]:''}_selectedDateChanged(g,h){void 0===g||void 0===h||(this.value=this._formatISO(g),this._focusedDate=g,this._inputValue=g?h(g):'')}_focusedDateChanged(g,h){void 0!==g&&void 0!==h&&(this._ignoreFocusedDateChange||this._noInput||(this._inputValue=g?h(g):''))}_hasValue(g){return!!g}_handleDateChange(g,h,j){if(!h)return void(this[g]='');var l=this._parseDate(h);return l?void(!Vaadin.DatePickerHelper._dateEquals(this[g],l)&&(this[g]=l)):void(this.value=j)}_valueChanged(g,h){this._handleDateChange('_selectedDate',g,h)}_minChanged(g,h){this._handleDateChange('_minDate',g,h)}_maxChanged(g,h){this._handleDateChange('_maxDate',g,h)}_updateAlignmentAndPosition(){var g=Math.max(document.documentElement.clientWidth,window.innerWidth||0);this.$.dropdown.positionTarget=this._fullscreen?document.documentElement:this;var h=Math.max(document.documentElement.clientHeight,window.innerHeight||0),j=this.getBoundingClientRect().top>h/2,l=this.getBoundingClientRect().left+this.clientWidth/2>g/2;this.$.dropdown.verticalAlign=j?'bottom':'top',this.$.dropdown.horizontalAlign=this._fullscreen?null:l?'right':'left',this._fullscreen?(this.$.dropdown.style.marginTop=0,this.$.dropdown.style.marginBottom=0):(this.$.dropdown.style.marginTop=(j?10:this.clientHeight+2)+'px',this.$.dropdown.style.marginBottom=(j?this.clientHeight:10)+'px'),this.$.overlay._repositionYearScroller()}_fullscreenChanged(){this.$.dropdown.opened&&this._updateAlignmentAndPosition()}_onOverlayOpened(){var g=this._parseDate(this.initialPosition),h=this._selectedDate||this.$.overlay.initialPosition||g||new Date;this.$.overlay.initialPosition=g||Vaadin.DatePickerHelper._dateAllowed(h,this._minDate,this._maxDate)?h:Vaadin.DatePickerHelper._getClosestDate(h,[this._minDate,this._maxDate]),this.$.overlay.scrollToDate(this.$.overlay.focusedDate||this.$.overlay.initialPosition),this._ignoreFocusedDateChange=!0,this.$.overlay.focusedDate=this.$.overlay.focusedDate||this.$.overlay.initialPosition,this._ignoreFocusedDateChange=!1,window.addEventListener('scroll',this._boundOnScroll,!0),this.listen(this,'iron-resize','_updateAlignmentAndPosition'),''===document.createElement('div').style.webkitOverflowScrolling&&(this._touchPrevented=this._preventWebkitOverflowScrollingTouch(this.parentElement)),this._focusOverlayOnOpen?(this.$.overlay.focus(),this._focusOverlayOnOpen=!1):this._focus(),this.updateStyles(),this._documentPointerEvents=document.body.style.pointerEvents,document.body.style.pointerEvents='none',this._ignoreAnnounce=!1}_preventWebkitOverflowScrollingTouch(g){for(var h=[];g;){if('touch'===window.getComputedStyle(g).webkitOverflowScrolling){var j=g.style.webkitOverflowScrolling;g.style.webkitOverflowScrolling='auto',h.push({element:g,oldInlineValue:j})}g=g.parentElement}return h}_onOverlayClosed(){if(this._ignoreAnnounce=!0,window.removeEventListener('scroll',this._boundOnScroll,!0),this.unlisten(this,'iron-resize','_updateAlignmentAndPosition'),this._touchPrevented&&(this._touchPrevented.forEach(j=>j.element.style.webkitOverflowScrolling=j.oldInlineValue),this._touchPrevented=[]),this.updateStyles(),document.body.style.pointerEvents=this._documentPointerEvents,this._ignoreFocusedDateChange=!0,this.i18n.parseDate){var g=this._inputValue||'',h=this.i18n.parseDate(g);this._isValidDate(h)?this._selectedDate=h:(this._selectedDate=null,this._inputValue=g)}else this._focusedDate&&(this._selectedDate=this._focusedDate);this._ignoreFocusedDateChange=!1,this._nativeInput&&this._nativeInput.selectionStart&&(this._nativeInput.selectionStart=this._nativeInput.selectionEnd),this.validate()}detached(){this._onOverlayClosed()}validate(g){return g=void 0===g?this._inputValue:g,!(this.invalid=!this.checkValidity(g))}checkValidity(g){var h=!g||this._selectedDate&&g===this.i18n.formatDate(this._selectedDate),j=!this._selectedDate||Vaadin.DatePickerHelper._dateAllowed(this._selectedDate,this._minDate,this._maxDate),l=!0;return this._inputElement&&(this._inputElement.checkValidity?l=this._inputElement.checkValidity(g):this._inputElement.validate&&(l=this._inputElement.validate(g))),h&&j&&l}_onScroll(g){g.target!==window&&this.$.overlay.contains(g.target)||this._updateAlignmentAndPosition()}_preventCancelOnComponentAccess(g){var h=g.detail;/tap|mousedown|touchstart/.test(g.detail.type)&&-1<h.composedPath().indexOf(this)&&g.preventDefault()}_focus(){this._noInput?this.$.overlay.focus():this._nativeInput.focus()}_focusAndSelect(){this._focus(),this._setSelectionRange(0,this._inputValue.length)}_setSelectionRange(g,h){this._nativeInput&&this._nativeInput.setSelectionRange&&this._nativeInput.setSelectionRange(g,h)}_preventDefault(g){g.preventDefault()}_eventKey(g){for(var l,h=['down','up','enter','esc','tab'],j=0;j<h.length;j++)if(l=h[j],Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(g,l))return l}_isValidDate(g){return g&&!isNaN(g.getTime())}_onKeydown(g){if(this._noInput){-1===[9].indexOf(g.keyCode)&&g.preventDefault()}switch(this._eventKey(g)){case'down':case'up':g.preventDefault(),this.opened?(this.$.overlay.focus(),this.$.overlay._onKeydown(g)):(this._focusOverlayOnOpen=!0,this.open());break;case'enter':this.$.overlay.focusedDate&&(this._selectedDate=this.$.overlay.focusedDate),this.close();break;case'esc':this._focusedDate=this._selectedDate,this._close();break;case'tab':this.opened&&(g.preventDefault(),this._setSelectionRange(0,0),g.shiftKey?this.$.overlay.focusCancel():(this.$.overlay.focus(),this.$.overlay.revealDate(this._focusedDate)));}}_validateInput(g,h,j){g&&(h||j)&&(this.invalid=!Vaadin.DatePickerHelper._dateAllowed(g,h,j))}_onUserInput(){this._userInputValueChanged(),this.opened||(this.open(),this._ios&&(this._debouncerRefit=Polymer.Debouncer.debounce(this._debouncerRefit,Polymer.Async.timeOut.after(500),this.$.dropdown.refit)))}_userInputValueChanged(){if(this.opened&&this._inputValue){var h=this.i18n.parseDate&&this.i18n.parseDate(this._inputValue);this._isValidDate(h)&&(this._ignoreFocusedDateChange=!0,this._focusedDate=h,this._ignoreFocusedDateChange=!1)}}_announceFocusedDate(g,h,j){h&&!j&&this.$.overlay.announceFocusedDate()}};</script></head><body></body></html>