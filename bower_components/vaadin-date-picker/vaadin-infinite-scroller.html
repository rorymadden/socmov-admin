<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/legacy/class.html"><link rel="import" href="../polymer/lib/legacy/templatizer-behavior.html"></head><body><dom-module id="vaadin-infinite-scroller"><template><style>:host{display:block;overflow:hidden;height:500px;}#scroller{position:relative;height:100%;overflow:auto;outline:none;margin-right:-40px;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;overflow-x:hidden;}#scroller.notouchscroll{-webkit-overflow-scrolling:auto;}#scroller::-webkit-scrollbar{display:none;}.buffer{position:absolute;width:100%;box-sizing:border-box;padding-right:40px;top:var(--vaadin-inifnite-scroller-buffer-offset, 0);animation:fadein 0.2s;}@keyframes fadein{from{opacity:0;}to{opacity:1;}}</style><div id="scroller" on-scroll="_scroll"><div class="buffer"></div><div class="buffer"></div><div id="fullHeight"></div></div></template></dom-module><script>{class a extends Polymer.Element{static get is(){return'vaadin-infinite-scroller'}static get properties(){return{bufferSize:{type:Number,value:20},_initialScroll:{value:5e5},_initialIndex:{value:0},_buffers:Array,_preventScrollEvent:Boolean,_mayHaveMomentum:Boolean,_initialized:Boolean,active:{type:Boolean,observer:'_activated'}}}ready(){super.ready(),this._buffers=Array.prototype.slice.call(this.root.querySelectorAll('.buffer')),this.$.fullHeight.style.height=2*this._initialScroll+'px';var b=this.querySelector('template');this._TemplateClass=Polymer.Templatize.templatize(b,this,{forwardHostProp:function(d,e){'index'!==d&&this._buffers.forEach(f=>{[].forEach.call(f.children,g=>{g._itemWrapper.instance[d]=e})})}});var c=-1<navigator.userAgent.toLowerCase().indexOf('firefox');c&&(this.$.scroller.tabIndex=-1)}_activated(b){b&&!this._initialized&&(this._createPool(),this._initialized=!0)}_finishInit(){this._initDone||(this._buffers.forEach(b=>{[].forEach.call(b.children,c=>this._ensureStampedInstance(c._itemWrapper))},this),!this._buffers[0].translateY&&this._reset(),this._initDone=!0)}_translateBuffer(b){var c=b?1:0;this._buffers[c].translateY=this._buffers[c?0:1].translateY+this._bufferHeight*(c?-1:1),this._buffers[c].style.transform='translate3d(0, '+this._buffers[c].translateY+'px, 0)',this._buffers[c].updated=!1,this._buffers.reverse()}_scroll(){if(!this._scrollDisabled){var b=this.$.scroller.scrollTop;(b<this._bufferHeight||b>2*this._initialScroll-this._bufferHeight)&&(this._initialIndex=~~this.position,this._reset());var c=this.root.querySelector('.buffer').offsetTop,d=b>this._buffers[1].translateY+this.itemHeight+c,e=b<this._buffers[0].translateY+this.itemHeight+c;(d||e)&&(this._translateBuffer(e),this._updateClones()),this._preventScrollEvent||(this.dispatchEvent(new CustomEvent('custom-scroll',{bubbles:!1,composed:!0})),this._mayHaveMomentum=!0),this._preventScrollEvent=!1,this._debouncerScrollFinish=Polymer.Debouncer.debounce(this._debouncerScrollFinish,Polymer.Async.timeOut.after(200),()=>{var f=this.$.scroller.getBoundingClientRect();this._isVisible(this._buffers[0],f)||this._isVisible(this._buffers[1],f)||(this.position=this.position)})}}set position(b){this._preventScrollEvent=!0,b>this._firstIndex&&b<this._firstIndex+2*this.bufferSize?this.$.scroller.scrollTop=this.itemHeight*(b-this._firstIndex)+this._buffers[0].translateY:(this._initialIndex=~~b,this._reset(),this._scrollDisabled=!0,this.$.scroller.scrollTop+=b%1*this.itemHeight,this._scrollDisabled=!1),this._mayHaveMomentum&&(this.$.scroller.classList.add('notouchscroll'),this._mayHaveMomentum=!1,setTimeout(()=>{this.$.scroller.classList.remove('notouchscroll')},10))}get position(){return(this.$.scroller.scrollTop-this._buffers[0].translateY)/this.itemHeight+this._firstIndex}get itemHeight(){if(!this._itemHeightVal){const b=window.ShadyCSS?window.ShadyCSS.getComputedStyleValue(this,'--vaadin-infinite-scroller-item-height'):getComputedStyle(this).getPropertyValue('--vaadin-infinite-scroller-item-height');this._itemHeightVal=parseInt(b)}return this._itemHeightVal}get _bufferHeight(){return this.itemHeight*this.bufferSize}_reset(){this._scrollDisabled=!0,this.$.scroller.scrollTop=this._initialScroll,this._buffers[0].translateY=this._initialScroll-this._bufferHeight,this._buffers[1].translateY=this._initialScroll,this._buffers.forEach(b=>{b.style.transform='translate3d(0, '+b.translateY+'px, 0)'}),this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones(!0),this._debouncerUpdateClones=Polymer.Debouncer.debounce(this._debouncerUpdateClones,Polymer.Async.timeOut.after(200),()=>{this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones()}),this._scrollDisabled=!1}_createPool(){var b=this.getBoundingClientRect();this._buffers.forEach(c=>{for(var d=0;d<this.bufferSize;d++){const e=document.createElement('div');e.style.height=this.itemHeight+'px',e.instance={};const f=Vaadin.InfiniteScrollerElement._contentIndex=Vaadin.InfiniteScrollerElement._contentIndex+1||0,g='vaadin-infinite-scroller-item-content-'+f,h=document.createElement('slot');h.setAttribute('name',g),h._itemWrapper=e,c.appendChild(h),e.setAttribute('slot',g),this.appendChild(e),Polymer.dom.flush(),setTimeout(()=>{this._isVisible(e,b)&&this._ensureStampedInstance(e)},1)}},this),setTimeout(()=>{Polymer.RenderStatus.afterNextRender(this,this._finishInit.bind(this))},1)}_ensureStampedInstance(b){if(!b.firstElementChild){var c=b.instance;b.instance=new this._TemplateClass({}),b.appendChild(b.instance.root),Object.keys(c).forEach(d=>{b.instance.set(d,c[d])})}}_updateClones(b){this._firstIndex=~~((this._buffers[0].translateY-this._initialScroll)/this.itemHeight)+this._initialIndex;var c=b?this.$.scroller.getBoundingClientRect():void 0;this._buffers.forEach((d,e)=>{if(!d.updated){var f=this._firstIndex+this.bufferSize*e;[].forEach.call(d.children,(g,h)=>{const j=g._itemWrapper;(!b||this._isVisible(j,c))&&(j.instance.index=f+h)}),d.updated=!0}},this)}_isVisible(b,c){var d=b.getBoundingClientRect();return d.bottom>c.top&&d.top<c.bottom}}customElements.define(a.is,a),window.Vaadin=window.Vaadin||{},Vaadin.InfiniteScrollerElement=a}</script></body></html>