<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/mixins/gesture-event-listeners.html"><link rel="import" href="../iron-media-query/iron-media-query.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="import" href="../vaadin-text-field/vaadin-text-field.html"><link rel="import" href="../vaadin-button/vaadin-button.html"><link rel="import" href="../vaadin-themable-mixin/vaadin-themable-mixin.html"><link rel="import" href="vaadin-month-calendar.html"><link rel="import" href="vaadin-infinite-scroller.html"><link rel="import" href="vaadin-date-picker-helper.html"><link rel="import" href="vaadin-date-picker-styles.html"></head><body><dom-module id="vaadin-date-picker-overlay"><template><style>:host{display:flex;flex-direction:column;height:100%;width:100%;outline:none;background:#fff;}[part="overlay-header"]{display:flex;flex-shrink:0;flex-wrap:nowrap;align-items:center;}:host(:not([fullscreen])) [part="overlay-header"]{display:none;}[part="label"]{flex-grow:1;}[part="clear-button"],
      [part="toggle-button"],
      [part="years-toggle-button"]::before{font-family:'vaadin-date-picker-icons';}[part="clear-button"]:not([showclear]){display:none;}[part="clear-button"]::before{content:"\e901";}[part="toggle-button"]::before{content:"\e902";}[part="years-toggle-button"]{display:flex;}[part="years-toggle-button"][desktop]{display:none;}[part="years-toggle-button"]::before{content:"\e900";}:host(:not([years-visible])) [part="years-toggle-button"]::before{transform:rotate(180deg);}#scrollers{display:flex;height:100%;width:100%;position:relative;overflow:hidden;}[part="months"],
      [part="years"]{height:100%;}[part="months"]{--vaadin-infinite-scroller-item-height:250px;padding:0 8px;position:absolute;top:0;left:0;right:0;bottom:0;}#scrollers[desktop] [part="months"]{right:50px;transform:none !important;}[part="years"]{--vaadin-infinite-scroller-item-height:80px;width:50px;position:absolute;right:0;transform:translateX(100%);-webkit-tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;--vaadin-inifnite-scroller-buffer-offset:50%;}#scrollers[desktop] [part="years"]{position:absolute;transform:none !important;}[part="years"]::before{content:'';display:block;background:transparent;width:0;height:0;position:absolute;left:0;top:50%;transform:translateY(-50%);border-width:6px;border-style:solid;border-color:transparent;border-left-color:#000;}:host(.animate) [part="months"],
      :host(.animate) [part="years"]{transition:all 200ms;}[part="toolbar"]{display:flex;justify-content:space-between;z-index:2;flex-shrink:0;}[part~="overlay-header"]:not([desktop]){padding-bottom:40px;}[part~="years-toggle-button"]{position:absolute;top:auto;right:8px;bottom:0;z-index:1;padding:8px;}#announcer{display:inline-block;position:fixed;clip:rect(0, 0, 0, 0);clip-path:inset(100%);}</style><div id="announcer" role="alert" aria-live="polite">[[i18n.calendar]]</div><div part="overlay-header" on-touchend="_preventDefault" desktop$="[[_desktopMode]]" aria-hidden="true"><div part="label">[[_formatDisplayed(selectedDate, i18n.formatDate, label)]]</div><div part="clear-button" on-tap="_clear" showclear$="[[_showClear(selectedDate)]]"></div><div part="toggle-button" on-tap="_cancel"></div><div part="years-toggle-button" desktop$="[[_desktopMode]]" on-tap="_toggleYearScroller" aria-hidden="true">[[_yearAfterXMonths(_visibleMonthIndex)]]</div></div><div id="scrollers" desktop$="[[_desktopMode]]" on-track="_track"><vaadin-infinite-scroller id="monthScroller" on-custom-scroll="_onMonthScroll" on-touchstart="_onMonthScrollTouchStart" buffer-size="6" active="[[initialPosition]]" part="months"><template><vaadin-month-calendar i18n="[[i18n]]" month="[[_dateAfterXMonths(index)]]" selected-date="{{selectedDate}}" focused-date="[[focusedDate]]" ignore-taps="[[_ignoreTaps]]" show-week-numbers="[[showWeekNumbers]]" min-date="[[minDate]]" max-date="[[maxDate]]" focused$="[[_focused]]" part="month"></vaadin-month-calendar></template></vaadin-infinite-scroller><vaadin-infinite-scroller id="yearScroller" on-tap="_onYearTap" on-custom-scroll="_onYearScroll" on-touchstart="_onYearScrollTouchStart" buffer-size="25" active="[[initialPosition]]" part="years"><template><div part="year-number" role="button" current$="[[_isCurrentYear(index)]]" selected$="[[_isSelectedYear(index, selectedDate)]]">[[_yearAfterXYears(index)]]</div><div part="year-separator" aria-hidden="true"></div></template></vaadin-infinite-scroller></div><div on-touchend="_preventDefault" role="toolbar" part="toolbar"><vaadin-button id="todayButton" part="today-button" disabled="[[!_isTodayAllowed(minDate, maxDate)]]" on-tap="_onTodayTap">[[i18n.today]]</vaadin-button><vaadin-button id="cancelButton" part="cancel-button" on-tap="_cancel">[[i18n.cancel]]</vaadin-button></div><iron-media-query query="(min-width: 375px)" query-matches="{{_desktopMode}}"></iron-media-query></template><script>{class a extends Vaadin.ThemableMixin(Polymer.GestureEventListeners(Polymer.Element)){static get is(){return'vaadin-date-picker-overlay'}static get properties(){return{selectedDate:{type:Date,notify:!0},focusedDate:{type:Date,notify:!0,observer:'_focusedDateChanged'},_focusedMonthDate:Number,initialPosition:{type:Date,observer:'_initialPositionChanged'},_originDate:{value:new Date},_visibleMonthIndex:Number,_desktopMode:Boolean,_translateX:{observer:'_translateXChanged'},_yearScrollerWidth:{value:50},i18n:{type:Object},showWeekNumbers:{type:Boolean},_ignoreTaps:Boolean,_notTapping:Boolean,minDate:Date,maxDate:Date,_focused:Boolean,label:String}}ready(){super.ready(),this.setAttribute('tabindex',0),this.addEventListener('keydown',this._onKeydown.bind(this)),this.addEventListener('tap',this._stopPropagation.bind(this)),this.addEventListener('focus',this._onOverlayFocus.bind(this)),this.addEventListener('blur',this._onOverlayBlur.bind(this))}connectedCallback(){super.connectedCallback(),this._translateX=this._yearScrollerWidth,this._toggleAnimateClass(!0),Polymer.Gestures.setTouchAction(this.$.scrollers,'pan-y'),Polymer.IronA11yAnnouncer.requestAvailability()}announceFocusedDate(){var f=this._currentlyFocusedDate(),g=[];return Vaadin.DatePickerHelper._dateEquals(f,new Date)&&g.push(this.i18n.today),g=g.concat([this.i18n.weekdays[f.getDay()],f.getDate(),this.i18n.monthNames[f.getMonth()],f.getFullYear()]),this.showWeekNumbers&&1===this.i18n.firstDayOfWeek&&(g.push(this.i18n.week),g.push(Vaadin.DatePickerHelper._getISOWeekNumber(f))),void this.dispatchEvent(new CustomEvent('iron-announce',{bubbles:!0,composed:!0,detail:{text:g.join(' ')}}))}focusCancel(){this.$.cancelButton.focus()}scrollToDate(f,g){this._scrollToPosition(this._differenceInMonths(f,this._originDate),g)}_focusedDateChanged(f){this.revealDate(f)}_isCurrentYear(f){return 0===f}_isSelectedYear(f,g){if(g)return g.getFullYear()===this._originDate.getFullYear()+f}revealDate(f){if(f){var g=this._differenceInMonths(f,this._originDate),h=this.$.monthScroller.position>g,j=this.$.monthScroller.clientHeight/this.$.monthScroller.itemHeight,l=this.$.monthScroller.position+j-1<g;h?this._scrollToPosition(g,!0):l&&this._scrollToPosition(g-j+1,!0)}}_onOverlayFocus(){this._focused=!0}_onOverlayBlur(){this._focused=!1}_initialPositionChanged(f){this.scrollToDate(f)}_repositionYearScroller(){this._visibleMonthIndex=Math.floor(this.$.monthScroller.position),this.$.yearScroller.position=(this.$.monthScroller.position+this._originDate.getMonth())/12}_repositionMonthScroller(){this.$.monthScroller.position=12*this.$.yearScroller.position-this._originDate.getMonth(),this._visibleMonthIndex=Math.floor(this.$.monthScroller.position)}_onMonthScroll(){this._repositionYearScroller(),this._doIgnoreTaps()}_onYearScroll(){this._repositionMonthScroller(),this._doIgnoreTaps()}_onYearScrollTouchStart(){this._notTapping=!1,setTimeout(()=>this._notTapping=!0,300),this._repositionMonthScroller()}_onMonthScrollTouchStart(){this._repositionYearScroller()}_doIgnoreTaps(){this._ignoreTaps=!0,this._debouncer=Polymer.Debouncer.debounce(this._debouncer,Polymer.Async.timeOut.after(300),()=>this._ignoreTaps=!1)}_formatDisplayed(f,g,h){return f?g(f):h}_onTodayTap(){var f=new Date;this.$.monthScroller.position===this._differenceInMonths(f,this._originDate)?(this.selectedDate=f,this._close()):this._scrollToCurrentMonth()}_scrollToCurrentMonth(){this.focusedDate&&(this.focusedDate=new Date),this.scrollToDate(new Date,!0)}_showClear(f){return!!f}_onYearTap(f){if(!this._ignoreTaps&&!this._notTapping){var g=f.detail.y-(this.$.yearScroller.getBoundingClientRect().top+this.$.yearScroller.clientHeight/2),h=g/this.$.yearScroller.itemHeight;this._scrollToPosition(this.$.monthScroller.position+12*h,!0)}}_scrollToPosition(f,g){if(void 0!==this._targetPosition)return void(this._targetPosition=f);if(!g)return this.$.monthScroller.position=f,this._targetPosition=void 0,void this._repositionYearScroller();this._targetPosition=f;var h=(o,p,q,r)=>{return(o/=r/2,1>o)?q/2*o*o+p:(o--,-q/2*(o*(o-2)-1)+p)},j=g?300:0,l=0,m=this.$.monthScroller.position,n=o=>{l=l||o;var p=o-l;if(p<j){var q=h(p,m,this._targetPosition-m,j);this.$.monthScroller.position=q,window.requestAnimationFrame(n)}else this.dispatchEvent(new CustomEvent('scroll-animation-finished',{bubbles:!0,composed:!0,detail:{position:this._targetPosition,oldPosition:m}})),this.$.monthScroller.position=this._targetPosition,this._targetPosition=void 0;setTimeout(this._repositionYearScroller.bind(this),1)};window.requestAnimationFrame(n)}_limit(f,g){return Math.min(g.max,Math.max(g.min,f))}_handleTrack(f){if(!(10>Math.abs(f.detail.dx)||10<Math.abs(f.detail.ddy))){Math.abs(f.detail.ddx)>this._yearScrollerWidth/3&&this._toggleAnimateClass(!0);var g=this._translateX+f.detail.ddx;this._translateX=this._limit(g,{min:0,max:this._yearScrollerWidth})}}_track(f){if(!this._desktopMode)switch(f.detail.state){case'start':this._toggleAnimateClass(!1);break;case'track':this._handleTrack(f);break;case'end':this._toggleAnimateClass(!0),this._translateX>=this._yearScrollerWidth/2?this._closeYearScroller():this._openYearScroller();}}_toggleAnimateClass(f){f?this.classList.add('animate'):this.classList.remove('animate')}_toggleYearScroller(){this._isYearScrollerVisible()?this._closeYearScroller():this._openYearScroller()}_openYearScroller(){this._translateX=0,this.setAttribute('years-visible','')}_closeYearScroller(){this.removeAttribute('years-visible'),this._translateX=this._yearScrollerWidth}_isYearScrollerVisible(){return this._translateX<this._yearScrollerWidth/2}_translateXChanged(f){this._desktopMode||(this.$.monthScroller.style.transform='translateX('+(f-this._yearScrollerWidth)+'px)',this.$.yearScroller.style.transform='translateX('+f+'px)')}_yearAfterXYears(f){var g=new Date(this._originDate);return g.setFullYear(parseInt(f)+this._originDate.getFullYear()),g.getFullYear()}_yearAfterXMonths(f){return this._dateAfterXMonths(f).getFullYear()}_dateAfterXMonths(f){var g=new Date(this._originDate);return g.setDate(1),g.setMonth(parseInt(f)+this._originDate.getMonth()),g}_differenceInMonths(f,g){var h=12*(f.getFullYear()-g.getFullYear());return h-g.getMonth()+f.getMonth()}_differenceInYears(f,g){return this._differenceInMonths(f,g)/12}_clear(){this.selectedDate='',this._close()}_close(){this.dispatchEvent(new CustomEvent('close',{bubbles:!0,composed:!0}))}_cancel(){this.focusedDate=this.selectedDate,this._close()}_preventDefault(f){f.preventDefault()}_eventKey(f){for(var j,g=['down','up','right','left','enter','space','home','end','pageup','pagedown','tab'],h=0;h<g.length;h++)if(j=g[h],Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(f,j))return j}_onKeydown(f){var g=this._currentlyFocusedDate();const h=0<=f.composedPath().indexOf(this.$.todayButton),j=0<=f.composedPath().indexOf(this.$.cancelButton),l=!h&&!j;var m=this._eventKey(f);if('tab'===m){f.stopPropagation();const o=this.hasAttribute('fullscreen'),p=f.shiftKey;o?f.preventDefault():p&&l||!p&&j?(f.preventDefault(),this.dispatchEvent(new CustomEvent('focus-input',{bubbles:!0,composed:!0}))):p&&h?(this._focused=!0,setTimeout(()=>this.revealDate(this.focusedDate),1)):this._focused=!1}else if(m)switch(f.preventDefault(),f.stopPropagation(),m){case'down':this._moveFocusByDays(7),this.focus();break;case'up':this._moveFocusByDays(-7),this.focus();break;case'right':l&&this._moveFocusByDays(1);break;case'left':l&&this._moveFocusByDays(-1);break;case'enter':l||j?this._close():h&&this._onTodayTap();break;case'space':if(j)this._close();else if(h)this._onTodayTap();else{var n=this.focusedDate;Vaadin.DatePickerHelper._dateEquals(n,this.selectedDate)?(this.selectedDate='',this.focusedDate=n):this.selectedDate=n}break;case'home':this._moveFocusInsideMonth(g,'minDate');break;case'end':this._moveFocusInsideMonth(g,'maxDate');break;case'pagedown':this._moveFocusByMonths(f.shiftKey?12:1);break;case'pageup':this._moveFocusByMonths(f.shiftKey?-12:-1);}}_currentlyFocusedDate(){return this.focusedDate||this.selectedDate||this.initialPosition||new Date}_moveFocusByDays(f){var g=this._currentlyFocusedDate(),h=new Date(0,0);h.setFullYear(g.getFullYear()),h.setMonth(g.getMonth()),h.setDate(g.getDate()+f),this._dateAllowed(h,this.minDate,this.maxDate)?(this.focusedDate=h,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(g,this.minDate,this.maxDate)?0<f?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=Vaadin.DatePickerHelper._getClosestDate(g,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())}_moveFocusByMonths(f){var g=this._currentlyFocusedDate(),h=new Date(0,0);h.setFullYear(g.getFullYear()),h.setMonth(g.getMonth()+f);var j=h.getMonth();h.setDate(this._focusedMonthDate||(this._focusedMonthDate=g.getDate())),h.getMonth()!==j&&h.setDate(0),this._dateAllowed(h,this.minDate,this.maxDate)?this.focusedDate=h:this._dateAllowed(g,this.minDate,this.maxDate)?0<f?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=Vaadin.DatePickerHelper._getClosestDate(g,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())}_moveFocusInsideMonth(f,g){var h=new Date(0,0);h.setFullYear(f.getFullYear()),'minDate'===g?(h.setMonth(f.getMonth()),h.setDate(1)):(h.setMonth(f.getMonth()+1),h.setDate(0)),this._dateAllowed(h,this.minDate,this.maxDate)?(this.focusedDate=h,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(f,this.minDate,this.maxDate)?(this.focusedDate=this[g],this._focusedMonthDate=this[g].getDate()):(this.focusedDate=Vaadin.DatePickerHelper._getClosestDate(f,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())}_dateAllowed(f,g,h){return(!g||f>=g)&&(!h||f<=h)}_isTodayAllowed(f,g){var h=new Date,j=new Date(0,0);return j.setFullYear(h.getFullYear()),j.setMonth(h.getMonth()),j.setDate(h.getDate()),this._dateAllowed(j,f,g)}_stopPropagation(f){f.stopPropagation()}}customElements.define(a.is,a),window.Vaadin=window.Vaadin||{},Vaadin.DatePickerOverlayElement=a}</script></dom-module></body></html>